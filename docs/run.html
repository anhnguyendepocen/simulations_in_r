<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Running Simulations | Conducting Monte Carlo Simulations in R</title>
  <meta name="description" content="This short book contains the materials for my workshop: Conducting Simulations in R." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Running Simulations | Conducting Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This short book contains the materials for my workshop: Conducting Simulations in R." />
  <meta name="github-repo" content="okanbulut/simulations_in_r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Running Simulations | Conducting Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="This short book contains the materials for my workshop: Conducting Simulations in R." />
  

<meta name="author" content="Okan Bulut" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="design.html"/>
<link rel="next" href="summarise.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://sites.google.com/ualberta.ca/okanbulut/">Okan Bulut &copy;</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#overview"><i class="fa fa-check"></i><b>1.1</b> Overview</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#why-simulations"><i class="fa fa-check"></i><b>1.2</b> Why Simulations?</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#typical-simulation-scenarios"><i class="fa fa-check"></i><b>1.3</b> Typical Simulation Scenarios</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#additional-resources"><i class="fa fa-check"></i><b>1.4</b> Additional Resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="design.html"><a href="design.html"><i class="fa fa-check"></i><b>2</b> Designing Simulations</a><ul>
<li class="chapter" data-level="2.1" data-path="design.html"><a href="design.html#simulation-factors"><i class="fa fa-check"></i><b>2.1</b> Simulation Factors</a></li>
<li class="chapter" data-level="2.2" data-path="design.html"><a href="design.html#evaluation-criteria"><i class="fa fa-check"></i><b>2.2</b> Evaluation Criteria</a></li>
<li class="chapter" data-level="2.3" data-path="design.html"><a href="design.html#other-design-elements"><i class="fa fa-check"></i><b>2.3</b> Other Design Elements</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="run.html"><a href="run.html"><i class="fa fa-check"></i><b>3</b> Running Simulations</a><ul>
<li class="chapter" data-level="3.1" data-path="run.html"><a href="run.html#custom-functions"><i class="fa fa-check"></i><b>3.1</b> Custom Functions</a></li>
<li class="chapter" data-level="3.2" data-path="run.html"><a href="run.html#debugging-the-code"><i class="fa fa-check"></i><b>3.2</b> Debugging the Code</a><ul>
<li class="chapter" data-level="3.2.1" data-path="run.html"><a href="run.html#custom-messages"><i class="fa fa-check"></i><b>3.2.1</b> Custom Messages</a></li>
<li class="chapter" data-level="3.2.2" data-path="run.html"><a href="run.html#messages-and-warnings"><i class="fa fa-check"></i><b>3.2.2</b> Messages and Warnings</a></li>
<li class="chapter" data-level="3.2.3" data-path="run.html"><a href="run.html#interactive-debugging-with-browser"><i class="fa fa-check"></i><b>3.2.3</b> Interactive Debugging with <code>browser()</code></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="run.html"><a href="run.html#putting-the-functions-together"><i class="fa fa-check"></i><b>3.3</b> Putting the Functions Together</a><ul>
<li class="chapter" data-level="3.3.1" data-path="run.html"><a href="run.html#avoding-loops"><i class="fa fa-check"></i><b>3.3.1</b> Avoding Loops</a></li>
<li class="chapter" data-level="3.3.2" data-path="run.html"><a href="run.html#loops"><i class="fa fa-check"></i><b>3.3.2</b> Loops</a></li>
<li class="chapter" data-level="3.3.3" data-path="run.html"><a href="run.html#parallel-computing"><i class="fa fa-check"></i><b>3.3.3</b> Parallel Computing</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="run.html"><a href="run.html#benchmarking"><i class="fa fa-check"></i><b>3.4</b> Benchmarking</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="summarise.html"><a href="summarise.html"><i class="fa fa-check"></i><b>4</b> Summarizing Simulation Results</a><ul>
<li class="chapter" data-level="4.1" data-path="summarise.html"><a href="summarise.html#tables-and-figures"><i class="fa fa-check"></i><b>4.1</b> Tables and Figures</a></li>
<li class="chapter" data-level="4.2" data-path="summarise.html"><a href="summarise.html#exporting-the-results"><i class="fa fa-check"></i><b>4.2</b> Exporting the Results</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/okanbulut/simulations_in_r" target="blank">Published with GitHub</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Conducting Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="run" class="section level1">
<h1><span class="header-section-number">3</span> Running Simulations</h1>
<p><img src="figure/john-schnobrich-yFbyvpEGHFQ-unsplash.jpg" /></p>
<p>The secret of building a successful Monte Carlo simulation is to write several custom functions that work efficiently and more importantly – <strong>correctly</strong>. Then, we can:</p>
<ul>
<li>combine the custom functions within a single function and run the simulations using this function with nested loops, or</li>
<li>write several nested loops that run each custom function independently and carry its output to the next function.</li>
</ul>
<p>As we put the simulation functions together, we should be aware of potential errors that could either produce incorrect results or interrupt the execution of the simulation at different stages. Therefore, it is important to check all the functions carefully and patiently before running the simulations. Adding either notifications or diagnostic messages into the functions is also quite helpful for debugging problems that might occur in the functions.</p>
<p>Once all the simulation functions are checked, the next step is determine how to run the simulations as efficiently as possible. Loops are particularly slow in <code>R</code> when it comes to handling heavy computations and data operations. The <code>apply()</code> function collection including <code>apply()</code>, <code>sapply()</code>, and <code>lapply()</code> can help users avoid the loops and perform many computations and data operations very efficiently in <code>R</code>. For users who want to run their simulations with loops, parallel computing in <code>R</code> is also an excellent way to make the simulations faster. Regardless of which of these methods has been selected, it is useful to check running time of <code>R</code> codes – which is also known as <strong>benchmarking</strong>. We will discuss all of these steps in the remainder of Part <a href="run.html#run">3</a>.</p>
<div id="custom-functions" class="section level2">
<h2><span class="header-section-number">3.1</span> Custom Functions</h2>
<p>Writing custom functions does <strong>not</strong> mean that we must write every single algorithm from scratch. Instead, it means that we bring several functions (either new or existing) together so that they run the analysis that we want and return the results in the way we prefer. Going back to the hypothetical simulation scenario that we introducted in Part <a href="index.html#intro">1</a>, the researcher needs several custom functions for:</p>
<ol style="list-style-type: decimal">
<li>Generating response data</li>
<li>Estimating item parameters</li>
<li>Calculating bias, RMSE, and correlation</li>
</ol>
<p>In the first function, we want the function to generate item parameters based on the parameter distributions that we have mentioned in Part <a href="design.html#design">2</a> and to use these parameters to generate dichotomous response data following the 3PL model. We call this function <code>generate_data</code>. Our function has several arguments based on the simulation factors: <code>nitem</code> for the number of items, <code>nexaminee</code> for the number of examinees, and <code>seed</code> that allows us to control the random number generation. Setting the seed is very important in Monte Carlo simulations because it enables the reproducibility of simulation results. When we run the same function using the same seeds in the future, we should be able to generate the same parameters and response data.</p>
<p>To generate responses, we will use the <code>sim</code> function from the <code>irtoys</code> package <span class="citation">(Partchev and Maris <a href="#ref-R-irtoys" role="doc-biblioref">2017</a>)</span>. We could make <code>irtoys</code> a required package for our custom function, using <code>require("irtoys")</code>. This would activate the package every time we use <code>generate_data</code>. However, some packages can mask functions from other packages with the same names, when they are activated together within the same <code>R</code> session. Therefore, it is better to call the exact function that we want to use, instead of activating the entire package. Here we use <code>irtoys::sim</code> to call the <code>sim</code> function from <code>irtoys</code>.</p>
<p>Note that the three arguments, <code>nitem</code>, <code>nexaminee</code>, and <code>seed</code>, in the <code>generate_data</code> function are <strong>required</strong>. That is, all of these arguments must be specified as we run the simulations. This might create some problems in the simulation. We will talk about this in the debugging section later on.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">generate_data &lt;-<span class="st"> </span><span class="cf">function</span>(nitem, nexaminee, seed) {</a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="co"># Set the seed </span></a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5">  <span class="co"># Generate item parameters</span></a>
<a class="sourceLine" id="cb1-6" title="6">  itempar &lt;-<span class="st"> </span><span class="kw">cbind</span>(</a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="kw">rnorm</span>(nitem, <span class="dt">mean =</span> <span class="fl">1.13</span>, <span class="dt">sd =</span> <span class="fl">0.25</span>)<span class="op">*</span><span class="fl">1.702</span>, <span class="co">#a</span></a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="kw">rnorm</span>(nitem, <span class="dt">mean =</span> <span class="fl">0.21</span>, <span class="dt">sd =</span> <span class="fl">0.51</span>)<span class="op">*</span><span class="fl">1.702</span>, <span class="co">#b</span></a>
<a class="sourceLine" id="cb1-9" title="9">    <span class="kw">rnorm</span>(nitem, <span class="dt">mean =</span> <span class="fl">0.16</span>, <span class="dt">sd =</span> <span class="fl">0.05</span>))       <span class="co">#c</span></a>
<a class="sourceLine" id="cb1-10" title="10">  </a>
<a class="sourceLine" id="cb1-11" title="11">  <span class="co"># Generate ability parameters</span></a>
<a class="sourceLine" id="cb1-12" title="12">  ability &lt;-<span class="st"> </span><span class="kw">rnorm</span>(nexaminee, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-13" title="13">  </a>
<a class="sourceLine" id="cb1-14" title="14">  <span class="co"># Generate response data according to the 3PL model</span></a>
<a class="sourceLine" id="cb1-15" title="15">  respdata &lt;-<span class="st"> </span>irtoys<span class="op">::</span><span class="kw">sim</span>(<span class="dt">ip =</span> itempar, <span class="dt">x =</span> ability)</a>
<a class="sourceLine" id="cb1-16" title="16">  <span class="kw">colnames</span>(respdata) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;item&quot;</span>, <span class="dv">1</span><span class="op">:</span>nitem)</a>
<a class="sourceLine" id="cb1-17" title="17">  </a>
<a class="sourceLine" id="cb1-18" title="18">  <span class="co"># Combine the generated values in a list</span></a>
<a class="sourceLine" id="cb1-19" title="19">  data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">itempar =</span> itempar,</a>
<a class="sourceLine" id="cb1-20" title="20">               <span class="dt">ability =</span> ability,</a>
<a class="sourceLine" id="cb1-21" title="21">               <span class="dt">seed =</span> seed,</a>
<a class="sourceLine" id="cb1-22" title="22">               <span class="dt">respdata =</span> respdata)</a>
<a class="sourceLine" id="cb1-23" title="23">  </a>
<a class="sourceLine" id="cb1-24" title="24">  <span class="co"># Return the simulated data</span></a>
<a class="sourceLine" id="cb1-25" title="25">  <span class="kw">return</span>(data)</a>
<a class="sourceLine" id="cb1-26" title="26">}</a></code></pre></div>
<p>Our function saves the item parameters, ability parameters, simulated responses, and the seed for the <code>set.seed</code> argument. Let’s see if our function returns what we asked for.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">temp1a &lt;-<span class="st"> </span><span class="kw">generate_data</span>(<span class="dt">nitem =</span> <span class="dv">10</span>, <span class="dt">nexaminee =</span> <span class="dv">1000</span>, <span class="dt">seed =</span> <span class="dv">666</span>)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">head</span>(temp1a<span class="op">$</span>itempar)</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">head</span>(temp1a<span class="op">$</span>ability)</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">head</span>(temp1a<span class="op">$</span>respdata)</a></code></pre></div>
<pre><code>      [,1]    [,2]    [,3]
[1,] 2.244  2.2237 0.12540
[2,] 2.780 -1.1792 0.10085
[3,] 1.772  1.1080 0.22344
[4,] 2.786 -1.1357 0.14437
[5,] 0.980  0.4738 0.16153
[6,] 2.246  0.2916 0.08589</code></pre>
<pre><code>[1]  0.7550 -0.6415  1.4311 -0.6246  0.2290  0.2632</code></pre>
<pre><code>     item1 item2 item3 item4 item5 item6 item7 item8 item9 item10
[1,]     0     1     1     1     1     1     1     0     1      1
[2,]     0     1     1     1     1     0     0     0     0      0
[3,]     0     1     1     1     1     1     1     0     1      1
[4,]     0     1     0     0     0     0     0     0     1      0
[5,]     0     1     1     1     1     1     1     0     1      0
[6,]     0     1     1     1     0     1     0     1     0      1</code></pre>
<p>Our second function is the <code>mirt</code> function from the <code>mirt</code> package <span class="citation">(Chalmers <a href="#ref-R-mirt" role="doc-biblioref">2019</a>)</span>. We will create a custom function to be able to add a fixed guessing parameter and to extract the estimated item parameters. Here we will set <code>guess</code> as a negative value (e.g., -1), indicating that we want guessing to be freely estimated. However, if <code>guess</code> is greater than or equal to zero, then the guessing parameter will be fixed to this value in the function.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">estimate_par &lt;-<span class="st"> </span><span class="cf">function</span>(data, <span class="dt">guess =</span> <span class="dv">-1</span>) {</a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="co"># If guessing is fixed</span></a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="cf">if</span>(guess <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb6-4" title="4">    </a>
<a class="sourceLine" id="cb6-5" title="5">    <span class="co"># Model set up</span></a>
<a class="sourceLine" id="cb6-6" title="6">    mod3PL &lt;-<span class="st"> </span>mirt<span class="op">::</span><span class="kw">mirt</span>(data, <span class="co"># response data</span></a>
<a class="sourceLine" id="cb6-7" title="7">                         <span class="dv">1</span>,    <span class="co"># unidimensional model</span></a>
<a class="sourceLine" id="cb6-8" title="8">                         <span class="dt">guess =</span> guess, <span class="co"># fixed guessing</span></a>
<a class="sourceLine" id="cb6-9" title="9">                         <span class="dt">verbose =</span> <span class="ot">FALSE</span>, <span class="co"># Don&#39;t print verbose</span></a>
<a class="sourceLine" id="cb6-10" title="10">                         <span class="co"># Increase the number of EM cycles</span></a>
<a class="sourceLine" id="cb6-11" title="11">                         <span class="co"># Turn off estimation messages</span></a>
<a class="sourceLine" id="cb6-12" title="12">                         <span class="dt">technical =</span> <span class="kw">list</span>(<span class="dt">NCYCLES =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb6-13" title="13">                                          <span class="dt">message =</span> <span class="ot">FALSE</span>)) </a>
<a class="sourceLine" id="cb6-14" title="14">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb6-15" title="15">    mod3PL &lt;-<span class="st"> </span>mirt<span class="op">::</span><span class="kw">mirt</span>(data, <span class="co"># response data</span></a>
<a class="sourceLine" id="cb6-16" title="16">                         <span class="dv">1</span>,    <span class="co"># unidimensional model</span></a>
<a class="sourceLine" id="cb6-17" title="17">                         <span class="dt">itemtype =</span> <span class="st">&quot;3PL&quot;</span>, <span class="co"># IRT model</span></a>
<a class="sourceLine" id="cb6-18" title="18">                         <span class="dt">verbose =</span> <span class="ot">FALSE</span>, <span class="co"># Don&#39;t print verbose</span></a>
<a class="sourceLine" id="cb6-19" title="19">                         <span class="co"># Increase the number of EM cycles</span></a>
<a class="sourceLine" id="cb6-20" title="20">                         <span class="co"># Turn off estimation messages</span></a>
<a class="sourceLine" id="cb6-21" title="21">                         <span class="dt">technical =</span> <span class="kw">list</span>(<span class="dt">NCYCLES =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb6-22" title="22">                                          <span class="dt">message =</span> <span class="ot">FALSE</span>)) </a>
<a class="sourceLine" id="cb6-23" title="23">  }</a>
<a class="sourceLine" id="cb6-24" title="24">  </a>
<a class="sourceLine" id="cb6-25" title="25">  <span class="co"># Extract item parameters in typical IRT metric</span></a>
<a class="sourceLine" id="cb6-26" title="26">  itempar_est &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(mirt<span class="op">::</span><span class="kw">coef</span>(mod3PL, <span class="dt">IRTpars =</span> <span class="ot">TRUE</span>, <span class="dt">simplify =</span> <span class="ot">TRUE</span>)<span class="op">$</span>item[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])</a>
<a class="sourceLine" id="cb6-27" title="27">  <span class="kw">return</span>(itempar_est)</a>
<a class="sourceLine" id="cb6-28" title="28">}</a></code></pre></div>
<p>Let’s see if our <code>estimate_par</code> function can return what we want.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">temp1b &lt;-<span class="kw">estimate_par</span>(<span class="dt">data =</span> temp1a<span class="op">$</span>respdata, <span class="dt">guess =</span> <span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">head</span>(temp1b)</a></code></pre></div>
<pre><code>          a       b        g
item1 4.257  2.1529 0.123380
item2 3.192 -1.2152 0.002664
item3 1.738  1.1514 0.194192
item4 2.628 -1.1979 0.006361
item5 1.312  0.7376 0.315269
item6 2.103  0.3627 0.080536</code></pre>
<p>The last function necessary for this simulation study is a summary function that will provide bias, RMSE, and correlation values for the estimated parameters. We can come up with so many solutions for this step of the simulation. We can determine the best solution based on the answers to the following questions:</p>
<ol style="list-style-type: decimal">
<li><p>Do we want to save all the simulation results and summarize them all together once all the replications are completed? <em>This is a very safe option although saving all the results might take a lot of space or memory in the computer</em></p></li>
<li><p>Do we want to compute each evaluation index one by one and combine them in a data frame at the end? <em>This is a good option although this would require implementing separate functions for bias, RMSE, and correlation</em></p></li>
<li><p>Can we write a single function that computes all three indices and returns them in a single data frame? <em>This sounds more feasible because all the indices are computed together and then stored for each replication, though it might be harder to debug if a problem occurs</em></p></li>
</ol>
<p>We wil follow the third option and create a single summary function. Note that this will return the average bias and RMSE across <strong>all</strong> items in a <strong>single</strong> replication. Therefore, we would still have to summarize the results across all replications once the simulations are complete. We create <code>summarize</code> as a new function which takes two arguments: <code>est_params</code> as the estimated parameters and <code>true_params</code> as the true parameters. The function will calculate bias, RMSE, and correlations among the estimated and true parameters. Then, it will return them in a long-format data set (i.e., one row per parameter and the columns indicating our evaluation indices). Not to repeat the same computations for each column (i.e., parameter), we use <code>sapply</code> to apply the functions so that bias, RMSE, and correlation can be calculated for the a, b, and c parameters together.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">summarize &lt;-<span class="st"> </span><span class="cf">function</span>(est_params, true_params) {</a>
<a class="sourceLine" id="cb9-2" title="2">  result &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb9-3" title="3">    <span class="dt">parameter =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>),</a>
<a class="sourceLine" id="cb9-4" title="4">    <span class="dt">bias =</span> <span class="kw">sapply</span>(1L<span class="op">:</span>3L, <span class="cf">function</span>(i) <span class="kw">mean</span>((est_params[, i] <span class="op">-</span><span class="st"> </span>true_params[,i]))),</a>
<a class="sourceLine" id="cb9-5" title="5">    <span class="dt">rmse =</span> <span class="kw">sapply</span>(1L<span class="op">:</span>3L, <span class="cf">function</span>(i) <span class="kw">sqrt</span>(<span class="kw">mean</span>((est_params[, i] <span class="op">-</span><span class="st"> </span>true_params[,i])<span class="op">^</span><span class="dv">2</span>))),</a>
<a class="sourceLine" id="cb9-6" title="6">    <span class="dt">correlation =</span> <span class="kw">sapply</span>(1L<span class="op">:</span>3L, <span class="cf">function</span>(i) <span class="kw">cor</span>(est_params[, i], true_params[,i])))</a>
<a class="sourceLine" id="cb9-7" title="7">  <span class="kw">return</span>(result)</a>
<a class="sourceLine" id="cb9-8" title="8">}</a></code></pre></div>
<p>Finally, let’s test whether our final function, <code>summarize</code>, works properly.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">temp1c &lt;-<span class="st"> </span><span class="kw">summarize</span>(temp1b, temp1a<span class="op">$</span>itempar)</a>
<a class="sourceLine" id="cb10-2" title="2">temp1c</a></code></pre></div>
<pre><code>  parameter       bias    rmse correlation
1         a  0.2462034 0.67355      0.7435
2         b  0.0604238 0.11273      0.9957
3         c -0.0004633 0.07805      0.4464</code></pre>
</div>
<div id="debugging-the-code" class="section level2">
<h2><span class="header-section-number">3.2</span> Debugging the Code</h2>
<p>Debugging R codes is a rather tedious task, though this step is essential for the success of Monte Carlo simulation studies. It is important to test each custom function in a Monte Carlo simulation study as much as possible before we run them together within a single function or a loop. Otherwise, it might be harder to locate where the error occurs once the simulation begins. Especially with complex simulations, some errors might appear many hours (or even days) after we start running the simulations. Therefore, it is better to test each function in the simulation independently and then all together by following the sequence that all the functions would normally follow in the complete simulation.</p>
<p>In the following example, we will test one of the custom functions (<code>generate_data</code>) that we have created earlier. The function requires <code>nitem</code>, <code>nexaminee</code>, and <code>seed</code> as its arguments. What if we forget to include a seed when we are running this particular function? What would the function return? Using this example, we will review some of the debugging methods in <code>R</code>.</p>
<div id="custom-messages" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Custom Messages</h3>
<p>There are many ways to find where the error occurs in R codes. An old-fashioned and yet effective way for debugging R codes is to place custom messages (similar to annotations or comments in the code) throughout the functions. If the simulation stops at a certain point in the function, we can see the latest message printed and try to find the location of the problem accordingly.</p>
<p>Now let’s run the <code>generate_data</code> function without a seed and see what happens.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">temp2 &lt;-<span class="st"> </span><span class="kw">generate_data</span>(<span class="dt">nitem =</span> <span class="dv">10</span>, <span class="dt">nexaminee =</span> <span class="dv">1000</span>)</a></code></pre></div>
<pre><code>Error in set.seed(seed): argument &quot;seed&quot; is missing, with no default</code></pre>
<p>The output shows that the error is happening because we did not specify the seed. To fix the problem, we will revise our function by adding a condition: if seed is missing (i.e., NULL), then the function will randomly select an integer between 1 and 10,000 and use this random integer as the seed. In addition, we will add a few custom messages in the code, using <code>cat</code> and <code>print</code>. These will print messages in different forms as <code>R</code> runs each line of the code.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">generate_data &lt;-<span class="st"> </span><span class="cf">function</span>(nitem, nexaminee, <span class="dt">seed =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb14-2" title="2">  </a>
<a class="sourceLine" id="cb14-3" title="3">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(seed)) {</a>
<a class="sourceLine" id="cb14-4" title="4">    <span class="kw">set.seed</span>(seed)} </a>
<a class="sourceLine" id="cb14-5" title="5">  <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb14-6" title="6">    seed &lt;-<span class="st"> </span><span class="kw">sample.int</span>(<span class="dv">10000</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb14-7" title="7">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb14-8" title="8">    <span class="kw">cat</span>(<span class="st">&quot;Random seed = &quot;</span>, seed, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb14-9" title="9">  }</a>
<a class="sourceLine" id="cb14-10" title="10">  </a>
<a class="sourceLine" id="cb14-11" title="11">  <span class="kw">print</span>(<span class="st">&quot;Generated item parameters&quot;</span>)</a>
<a class="sourceLine" id="cb14-12" title="12">  itempar &lt;-<span class="st"> </span><span class="kw">cbind</span>(</a>
<a class="sourceLine" id="cb14-13" title="13">    <span class="kw">rnorm</span>(nitem, <span class="dt">mean =</span> <span class="fl">1.13</span>, <span class="dt">sd =</span> <span class="fl">0.25</span>), <span class="co">#a</span></a>
<a class="sourceLine" id="cb14-14" title="14">    <span class="kw">rnorm</span>(nitem, <span class="dt">mean =</span> <span class="fl">0.21</span>, <span class="dt">sd =</span> <span class="fl">0.51</span>), <span class="co">#b</span></a>
<a class="sourceLine" id="cb14-15" title="15">    <span class="kw">rnorm</span>(nitem, <span class="dt">mean =</span> <span class="fl">0.16</span>, <span class="dt">sd =</span> <span class="fl">0.05</span>)) <span class="co">#c</span></a>
<a class="sourceLine" id="cb14-16" title="16">  </a>
<a class="sourceLine" id="cb14-17" title="17">  <span class="kw">print</span>(<span class="st">&quot;Generated ability parameters&quot;</span>)</a>
<a class="sourceLine" id="cb14-18" title="18">  ability &lt;-<span class="st"> </span><span class="kw">rnorm</span>(nexaminee, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb14-19" title="19">  </a>
<a class="sourceLine" id="cb14-20" title="20">  <span class="kw">print</span>(<span class="st">&quot;Generated response data&quot;</span>)</a>
<a class="sourceLine" id="cb14-21" title="21">  respdata &lt;-<span class="st"> </span>irtoys<span class="op">::</span><span class="kw">sim</span>(<span class="dt">ip =</span> itempar, <span class="dt">x =</span> ability)</a>
<a class="sourceLine" id="cb14-22" title="22">  <span class="kw">colnames</span>(respdata) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;item&quot;</span>, <span class="dv">1</span><span class="op">:</span>nitem)</a>
<a class="sourceLine" id="cb14-23" title="23">  </a>
<a class="sourceLine" id="cb14-24" title="24">  <span class="kw">print</span>(<span class="st">&quot;Combined everything in a list&quot;</span>)</a>
<a class="sourceLine" id="cb14-25" title="25">  data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">itempar =</span> itempar,</a>
<a class="sourceLine" id="cb14-26" title="26">               <span class="dt">ability =</span> ability,</a>
<a class="sourceLine" id="cb14-27" title="27">               <span class="dt">seed =</span> seed,</a>
<a class="sourceLine" id="cb14-28" title="28">               <span class="dt">respdata =</span> respdata)</a>
<a class="sourceLine" id="cb14-29" title="29">  </a>
<a class="sourceLine" id="cb14-30" title="30">  <span class="co"># Return the simulated data</span></a>
<a class="sourceLine" id="cb14-31" title="31">  <span class="kw">return</span>(data)</a>
<a class="sourceLine" id="cb14-32" title="32">}</a></code></pre></div>
<p>Now let’s see what our updated function would return if we forget to provide a seed.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">temp2 &lt;-<span class="st"> </span><span class="kw">generate_data</span>(<span class="dt">nitem =</span> <span class="dv">10</span>, <span class="dt">nexaminee =</span> <span class="dv">1000</span>)</a></code></pre></div>
<pre><code>Random seed =  7680 
[1] &quot;Generated item parameters&quot;
[1] &quot;Generated ability parameters&quot;
[1] &quot;Generated response data&quot;
[1] &quot;Combined everything in a list&quot;</code></pre>
</div>
<div id="messages-and-warnings" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Messages and Warnings</h3>
<p>There are other ways to add debugging-related messages into functions, such as:</p>
<ul>
<li><code>message</code>: A custom, diagnostic message created by the <code>message()</code> function. The message gets printed only if a particular condition is or is not met. This does <strong>not</strong> stop the execution of the function.</li>
<li><code>warning</code>: A custom, warning message via <code>warning()</code>. The message indicates that something is wrong with the function but the execution of the function continues.</li>
</ul>
<p>Using the previous example, we will modify our function by adding a warning message showing there is no seed specified in the function and a message indicating the random seed assigned by the function itself (instead of a user-defined seed).</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">generate_data &lt;-<span class="st"> </span><span class="cf">function</span>(nitem, nexaminee, <span class="dt">seed =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb17-2" title="2">  </a>
<a class="sourceLine" id="cb17-3" title="3">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(seed)) {</a>
<a class="sourceLine" id="cb17-4" title="4">    <span class="kw">set.seed</span>(seed)} </a>
<a class="sourceLine" id="cb17-5" title="5">  <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb17-6" title="6">    <span class="kw">warning</span>(<span class="st">&quot;No seed provided!&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb17-7" title="7">    seed &lt;-<span class="st"> </span><span class="kw">sample.int</span>(<span class="dv">10000</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb17-8" title="8">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb17-9" title="9">    <span class="kw">message</span>(<span class="st">&quot;Random seed = &quot;</span>, seed, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb17-10" title="10">  }</a>
<a class="sourceLine" id="cb17-11" title="11">  </a>
<a class="sourceLine" id="cb17-12" title="12">  itempar &lt;-<span class="st"> </span><span class="kw">cbind</span>(</a>
<a class="sourceLine" id="cb17-13" title="13">    <span class="kw">rnorm</span>(nitem, <span class="dt">mean =</span> <span class="fl">1.13</span>, <span class="dt">sd =</span> <span class="fl">0.25</span>), <span class="co">#a</span></a>
<a class="sourceLine" id="cb17-14" title="14">    <span class="kw">rnorm</span>(nitem, <span class="dt">mean =</span> <span class="fl">0.21</span>, <span class="dt">sd =</span> <span class="fl">0.51</span>), <span class="co">#b</span></a>
<a class="sourceLine" id="cb17-15" title="15">    <span class="kw">rnorm</span>(nitem, <span class="dt">mean =</span> <span class="fl">0.16</span>, <span class="dt">sd =</span> <span class="fl">0.05</span>)) <span class="co">#c</span></a>
<a class="sourceLine" id="cb17-16" title="16">  </a>
<a class="sourceLine" id="cb17-17" title="17">  ability &lt;-<span class="st"> </span><span class="kw">rnorm</span>(nexaminee, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb17-18" title="18">  </a>
<a class="sourceLine" id="cb17-19" title="19">  respdata &lt;-<span class="st"> </span>irtoys<span class="op">::</span><span class="kw">sim</span>(<span class="dt">ip =</span> itempar, <span class="dt">x =</span> ability)</a>
<a class="sourceLine" id="cb17-20" title="20">  <span class="kw">colnames</span>(respdata) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;item&quot;</span>, <span class="dv">1</span><span class="op">:</span>nitem)</a>
<a class="sourceLine" id="cb17-21" title="21">  </a>
<a class="sourceLine" id="cb17-22" title="22">  data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">itempar =</span> itempar,</a>
<a class="sourceLine" id="cb17-23" title="23">               <span class="dt">ability =</span> ability,</a>
<a class="sourceLine" id="cb17-24" title="24">               <span class="dt">seed =</span> seed,</a>
<a class="sourceLine" id="cb17-25" title="25">               <span class="dt">respdata =</span> respdata)</a>
<a class="sourceLine" id="cb17-26" title="26">  </a>
<a class="sourceLine" id="cb17-27" title="27">  <span class="kw">return</span>(data)</a>
<a class="sourceLine" id="cb17-28" title="28">}</a></code></pre></div>
<p>What if we want to catch all errors and warnings as the function runs and store these messages to be review at the end? The answer comes from a solution offered in the R-help mailing list (see <code>demo(error.catching</code>):</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">tryCatch.W.E &lt;-<span class="st"> </span><span class="cf">function</span>(expr) {</a>
<a class="sourceLine" id="cb18-2" title="2">  W &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb18-3" title="3">  w.handler &lt;-<span class="st"> </span><span class="cf">function</span>(w){ <span class="co"># warning handler</span></a>
<a class="sourceLine" id="cb18-4" title="4">    W &lt;&lt;-<span class="st"> </span>w</a>
<a class="sourceLine" id="cb18-5" title="5">    <span class="kw">invokeRestart</span>(<span class="st">&quot;muffleWarning&quot;</span>)</a>
<a class="sourceLine" id="cb18-6" title="6">    }</a>
<a class="sourceLine" id="cb18-7" title="7">  <span class="kw">list</span>(<span class="dt">value =</span> <span class="kw">withCallingHandlers</span>(<span class="kw">tryCatch</span>(expr, <span class="dt">error =</span> <span class="cf">function</span>(e) e),</a>
<a class="sourceLine" id="cb18-8" title="8">                                   <span class="dt">warning =</span> w.handler), <span class="dt">warning =</span> W)</a>
<a class="sourceLine" id="cb18-9" title="9">}</a>
<a class="sourceLine" id="cb18-10" title="10"></a>
<a class="sourceLine" id="cb18-11" title="11">temp3 &lt;-<span class="st"> </span><span class="kw">tryCatch.W.E</span>(<span class="kw">generate_data</span>(<span class="dt">nitem =</span> <span class="dv">10</span>, <span class="dt">nexaminee =</span> <span class="dv">1000</span>))</a></code></pre></div>
<p><code>temp3</code> stores both the results of <code>generate_data</code> and the warning message.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">str</span>(temp3)</a></code></pre></div>
<pre><code>List of 2
 $ value  :List of 4
  ..$ itempar : num [1:10, 1:3] 1.36 1.02 1.2 1.3 1.26 ...
  ..$ ability : num [1:1000] -0.7446 0.0013 -0.8943 -0.6846 -0.8861 ...
  ..$ seed    : int 6984
  ..$ respdata: num [1:1000, 1:10] 0 1 0 0 1 1 1 0 1 1 ...
  .. ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. .. ..$ : NULL
  .. .. ..$ : chr [1:10] &quot;item1&quot; &quot;item2&quot; &quot;item3&quot; &quot;item4&quot; ...
 $ warning:List of 2
  ..$ message: chr &quot;No seed provided!&quot;
  ..$ call   : NULL
  ..- attr(*, &quot;class&quot;)= chr [1:3] &quot;simpleWarning&quot; &quot;warning&quot; &quot;condition&quot;</code></pre>
<p>Let’s see if our function returned any warnings:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">temp3<span class="op">$</span>warning</a></code></pre></div>
<pre><code>&lt;simpleWarning: No seed provided!&gt;</code></pre>
</div>
<div id="interactive-debugging-with-browser" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Interactive Debugging with <code>browser()</code></h3>
<p>A relatively more sophisticated way to diagnose a problem in R codes is to use <code>browser()</code>. This stops the execution of our codes and opens an interactive debugging screen. Using this debugging screen, we can do several things such as viewing what objects we have in the current <code>R</code> environment, modifying these objects, and them continuing running the code after these changes.</p>
<p>Now assume that users of our <code>generate_data</code> function <em>must</em> use their own seed, instead of having the function to generate one automatically. Therefore, we want to the function to stop if that occurs. We will use the <code>stop</code> function for this process. This function can be placed within an <code>if</code> statement to prevent the function for continuing – <em>if a particular condition (or multiple conditions) occurs</em>. Another version of this function is <code>stopifnot</code> which stops the function if a particular condition does <strong>not</strong> occur. To see how <code>stopifnot</code> works, you can type <code>?stopifnot</code> in the <code>R</code> console and check out its help page. In the following example, we will use <code>stop</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">generate_data &lt;-<span class="st"> </span><span class="cf">function</span>(nitem, nexaminee, <span class="dt">seed =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb23-2" title="2">  </a>
<a class="sourceLine" id="cb23-3" title="3">  <span class="cf">if</span>(<span class="kw">is.null</span>(seed)) {</a>
<a class="sourceLine" id="cb23-4" title="4">    <span class="kw">stop</span>(<span class="st">&quot;A seed must be provided!&quot;</span>)} </a>
<a class="sourceLine" id="cb23-5" title="5">  <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb23-6" title="6">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb23-7" title="7">  }</a>
<a class="sourceLine" id="cb23-8" title="8">  </a>
<a class="sourceLine" id="cb23-9" title="9">  <span class="kw">print</span>(<span class="st">&quot;Generated item parameters&quot;</span>)</a>
<a class="sourceLine" id="cb23-10" title="10">  itempar &lt;-<span class="st"> </span><span class="kw">cbind</span>(</a>
<a class="sourceLine" id="cb23-11" title="11">    <span class="kw">rnorm</span>(nitem, <span class="dt">mean =</span> <span class="fl">1.13</span>, <span class="dt">sd =</span> <span class="fl">0.25</span>), <span class="co">#a</span></a>
<a class="sourceLine" id="cb23-12" title="12">    <span class="kw">rnorm</span>(nitem, <span class="dt">mean =</span> <span class="fl">0.21</span>, <span class="dt">sd =</span> <span class="fl">0.51</span>), <span class="co">#b</span></a>
<a class="sourceLine" id="cb23-13" title="13">    <span class="kw">rnorm</span>(nitem, <span class="dt">mean =</span> <span class="fl">0.16</span>, <span class="dt">sd =</span> <span class="fl">0.05</span>)) <span class="co">#c</span></a>
<a class="sourceLine" id="cb23-14" title="14">  </a>
<a class="sourceLine" id="cb23-15" title="15">  <span class="kw">print</span>(<span class="st">&quot;Generated ability parameters&quot;</span>)</a>
<a class="sourceLine" id="cb23-16" title="16">  ability &lt;-<span class="st"> </span><span class="kw">rnorm</span>(nexaminee, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb23-17" title="17">  </a>
<a class="sourceLine" id="cb23-18" title="18">  <span class="kw">print</span>(<span class="st">&quot;Generated response data&quot;</span>)</a>
<a class="sourceLine" id="cb23-19" title="19">  respdata &lt;-<span class="st"> </span>irtoys<span class="op">::</span><span class="kw">sim</span>(<span class="dt">ip =</span> itempar, <span class="dt">x =</span> ability)</a>
<a class="sourceLine" id="cb23-20" title="20">  <span class="kw">colnames</span>(respdata) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;item&quot;</span>, <span class="dv">1</span><span class="op">:</span>nitem)</a>
<a class="sourceLine" id="cb23-21" title="21">  </a>
<a class="sourceLine" id="cb23-22" title="22">  <span class="kw">print</span>(<span class="st">&quot;Combined everything in a list&quot;</span>)</a>
<a class="sourceLine" id="cb23-23" title="23">  data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">itempar =</span> itempar,</a>
<a class="sourceLine" id="cb23-24" title="24">               <span class="dt">ability =</span> ability,</a>
<a class="sourceLine" id="cb23-25" title="25">               <span class="dt">seed =</span> seed,</a>
<a class="sourceLine" id="cb23-26" title="26">               <span class="dt">respdata =</span> respdata)</a>
<a class="sourceLine" id="cb23-27" title="27">  </a>
<a class="sourceLine" id="cb23-28" title="28">  <span class="co"># Return the simulated data</span></a>
<a class="sourceLine" id="cb23-29" title="29">  <span class="kw">return</span>(data)</a>
<a class="sourceLine" id="cb23-30" title="30">}</a>
<a class="sourceLine" id="cb23-31" title="31"></a>
<a class="sourceLine" id="cb23-32" title="32">temp3 &lt;-<span class="st"> </span><span class="kw">generate_data</span>(<span class="dt">nitem =</span> <span class="dv">10</span>, <span class="dt">nexaminee =</span> <span class="dv">1000</span>)</a></code></pre></div>
<p>Running the above code above would activate the debugging mode in RStudio and the console would like this:</p>
<div class="figure">
<img src="figure/debug1.PNG" alt="Console once the interactive debugging begins" />
<p class="caption">Console once the interactive debugging begins</p>
</div>
<p>RStudio enables the browsing mode automatically in most cases – this is why we have seen <code>Browse[1]&gt;</code> after the error occured in the code. Using the browser buttons, we can evaluate the next statement, evaluate the next statement but step into the current function, execute the remainder of the function, continue executing the code until the next error or breaking point, or exit the debug mode, based on the buttons from left to right (see the figure below).</p>
<div class="figure">
<img src="figure/Inkeddebug3_LI.jpg" alt="Debugging menu options" />
<p class="caption">Debugging menu options</p>
</div>
<p>In addition to the console, the source (where we are writing the codes) would show:</p>
<div class="figure">
<img src="figure/debug4.PNG" alt="Error location in the interactive debugging" />
<p class="caption">Error location in the interactive debugging</p>
</div>
<p>The figure above shows that the browser was able to find the location of the error. We can also activate the debugging mode for a particular function using <code>debug()</code>. For example, using <code>debug(generate_data)</code> and running <code>temp3 &lt;- generate_data(nitem = 10, nexaminee = 1000)</code> will show the following output in the console. By clicking on the “next” button, we can debug the code slowly and see where the error occurred. Once we are satisfied with the function, we can turn off the interactive debugging mode using the <code>undebug()</code> function.</p>
<div class="figure">
<img src="figure/debug5.PNG" alt="Using the debug() function" />
<p class="caption">Using the debug() function</p>
</div>
<p>If we want to see how we came to this particular error in the function, we can hit “enter” to exit the browser mode and type <code>traceback()</code>. This would return the steps that we have taken until the error message:</p>
<div class="figure">
<img src="figure/debug2.PNG" alt="The traceback() option in R" />
<p class="caption">The traceback() option in R</p>
</div>
<hr />
<p>For more further information about debugging in <code>R</code>, I highly recommend you to check out:</p>
<ul>
<li>the <a href="https://adv-r.hadley.nz/debugging.html">Debugging</a> chapter in Hadley Wickham’s <a href="https://adv-r.hadley.nz/">Advanced R</a>, and</li>
<li>the <a href="https://rstats.wtf/debugging-r-code.html">Debugging R Code</a> chapter in Jennifer Bryan and Jim Hester’s <a href="https://rstats.wtf/">What They Forgot to Teach You About R</a></li>
</ul>
<hr />
</div>
</div>
<div id="putting-the-functions-together" class="section level2">
<h2><span class="header-section-number">3.3</span> Putting the Functions Together</h2>
<p>As we put all the custom functions together, we must determine:</p>
<ol style="list-style-type: decimal">
<li>whether we want to run each custom function separately or in a single wrapper function that simply calls all of our custom functions</li>
<li>how we want to replicate our custom functions:</li>
</ol>
<ul>
<li>the <code>replicate</code> function</li>
<li>the <code>apply</code> function collection</li>
<li>loops (with single cluster or parallel computing)</li>
</ul>
<div id="avoding-loops" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Avoding Loops</h3>
<p>One of the easiest ways to repeat the same function without a loop is to use the <code>replicate</code> function in <code>R</code>. The way this function works is very simple. Let’s take a look at its basic structure:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">replicate</span>(<span class="op">&lt;</span>number of replications<span class="op">&gt;</span>, <span class="op">&lt;</span><span class="cf">function</span> to be replicated<span class="op">&gt;</span>)</a></code></pre></div>
<p>Using the <code>repeat</code> function, we can run the <code>generate_data</code> function many times very quickly. For example, let’s create 5 data sets (i.e., 5 replications):</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">nreps =<span class="st"> </span>5L</a>
<a class="sourceLine" id="cb25-2" title="2">x &lt;-<span class="st"> </span><span class="kw">replicate</span>(nreps, <span class="kw">generate_data</span>(<span class="dt">nitem =</span> <span class="dv">10</span>, <span class="dt">nexaminee =</span> <span class="dv">1000</span>))</a>
<a class="sourceLine" id="cb25-3" title="3"><span class="kw">head</span>(x)</a></code></pre></div>
<pre><code>         [,1]          [,2]          [,3]          [,4]          [,5]         
itempar  Numeric,30    Numeric,30    Numeric,30    Numeric,30    Numeric,30   
ability  Numeric,1000  Numeric,1000  Numeric,1000  Numeric,1000  Numeric,1000 
seed     8022          3891          7049          811           6957         
respdata Numeric,10000 Numeric,10000 Numeric,10000 Numeric,10000 Numeric,10000</code></pre>
<p>This would return an array (i.e., vector) called <code>x</code> which would store our simulated data sets returned from <code>generate_data</code>. To call a particular data set from this array (e.g., data set 1), we would use:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">x[,<span class="dv">1</span>]</a></code></pre></div>
<p>which would return all the components (i.e., item parameters, ability parameters, seed, and response data) from data set 1.</p>
<p>Another effective method to repeat a function several times without a loop is to use the <code>apply</code> function collection: <code>apply()</code>, <code>sapply()</code>, and <code>lapply()</code>. The purpose of these functions is primarily to avoid explicit uses of loops when repeating a particular task in <code>R</code><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. Among these three functions, <code>sapply()</code> and <code>lapply()</code> are particularly useful in simulations because they can apply an existing function (e..g, mean, median, sd) or a custom function to each element of an object. The difference between <code>lapply()</code> and <code>sapply()</code> lies between the output they return. <code>lapply()</code> applies a function and returns a list as its output, whereas <code>sapply()</code> returns a vector as its output.</p>
<p>In the following example, we want to extract the true item parameters from each replication stored in <code>x</code>. This is the first element of the output returned from <code>generate_data</code>. Therefore, we will use both <code>lapply</code> and <code>sapply</code> to select the first element of 5 replications stored in <code>x</code>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1"><span class="co"># lapply - returning a list</span></a>
<a class="sourceLine" id="cb28-2" title="2"><span class="kw">lapply</span>(1L<span class="op">:</span>nreps, <span class="cf">function</span>(i) x[,i][<span class="dv">1</span>])</a></code></pre></div>
<pre><code>[[1]]
[[1]]$itempar
        [,1]    [,2]    [,3]
 [1,] 1.1415 -0.3682 0.07736
 [2,] 1.3827  0.3420 0.24551
 [3,] 1.0107  0.4589 0.14046
 [4,] 0.9634  0.1928 0.10050
 [5,] 1.0133  0.7065 0.23558
 [6,] 0.9482  0.1607 0.16483
 [7,] 0.8283 -0.3466 0.11231
 [8,] 1.3640  0.3054 0.17842
 [9,] 0.5806  0.3969 0.16591
[10,] 1.8895  0.1825 0.12764


[[2]]
[[2]]$itempar
        [,1]      [,2]    [,3]
 [1,] 0.8686  0.211830 0.23417
 [2,] 1.0666 -0.647674 0.22204
 [3,] 1.3665 -0.179088 0.15410
 [4,] 0.8196  0.206515 0.19359
 [5,] 1.2334  0.005374 0.25132
 [6,] 1.0186 -0.120199 0.27701
 [7,] 1.0917 -0.096444 0.20174
 [8,] 1.1214  0.387298 0.06626
 [9,] 1.4620 -0.353471 0.18427
[10,] 0.9542 -0.386885 0.11406


[[3]]
[[3]]$itempar
        [,1]      [,2]    [,3]
 [1,] 0.8242  0.596302 0.07725
 [2,] 1.6065 -0.290621 0.17878
 [3,] 1.2838  0.728311 0.20805
 [4,] 1.0859 -0.440566 0.16173
 [5,] 1.1749 -0.045554 0.23987
 [6,] 1.1786  0.006729 0.22537
 [7,] 0.8680  1.019832 0.15020
 [8,] 1.4489 -0.435660 0.14789
 [9,] 1.4630  1.346885 0.12883
[10,] 0.5805 -0.130311 0.26612


[[4]]
[[4]]$itempar
        [,1]     [,2]    [,3]
 [1,] 1.0833 -0.62881 0.18135
 [2,] 1.4569  0.35718 0.16981
 [3,] 1.4572  0.58300 0.15132
 [4,] 0.8332  0.77767 0.19911
 [5,] 0.7998  0.84951 0.07186
 [6,] 1.2964  1.40714 0.19965
 [7,] 1.0498  0.25638 0.23851
 [8,] 1.1080 -0.58124 0.16927
 [9,] 0.7451  0.08085 0.18025
[10,] 0.8302  0.61757 0.18997


[[5]]
[[5]]$itempar
        [,1]     [,2]    [,3]
 [1,] 1.2428  0.38038 0.15683
 [2,] 0.9222  0.06897 0.14285
 [3,] 1.2159 -0.53983 0.08549
 [4,] 1.3092  0.47354 0.17746
 [5,] 1.0709 -0.15980 0.20135
 [6,] 0.8401  0.70899 0.20493
 [7,] 1.0457 -0.57915 0.19977
 [8,] 1.0311  0.96456 0.22195
 [9,] 1.4022 -0.48486 0.16690
[10,] 0.8243 -0.12529 0.11996</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1"><span class="co"># sapply - returning a vector or matrix</span></a>
<a class="sourceLine" id="cb30-2" title="2"><span class="kw">sapply</span>(1L<span class="op">:</span>nreps, <span class="cf">function</span>(i) x[,i][<span class="dv">1</span>])</a></code></pre></div>
<pre><code>$itempar
        [,1]    [,2]    [,3]
 [1,] 1.1415 -0.3682 0.07736
 [2,] 1.3827  0.3420 0.24551
 [3,] 1.0107  0.4589 0.14046
 [4,] 0.9634  0.1928 0.10050
 [5,] 1.0133  0.7065 0.23558
 [6,] 0.9482  0.1607 0.16483
 [7,] 0.8283 -0.3466 0.11231
 [8,] 1.3640  0.3054 0.17842
 [9,] 0.5806  0.3969 0.16591
[10,] 1.8895  0.1825 0.12764

$itempar
        [,1]      [,2]    [,3]
 [1,] 0.8686  0.211830 0.23417
 [2,] 1.0666 -0.647674 0.22204
 [3,] 1.3665 -0.179088 0.15410
 [4,] 0.8196  0.206515 0.19359
 [5,] 1.2334  0.005374 0.25132
 [6,] 1.0186 -0.120199 0.27701
 [7,] 1.0917 -0.096444 0.20174
 [8,] 1.1214  0.387298 0.06626
 [9,] 1.4620 -0.353471 0.18427
[10,] 0.9542 -0.386885 0.11406

$itempar
        [,1]      [,2]    [,3]
 [1,] 0.8242  0.596302 0.07725
 [2,] 1.6065 -0.290621 0.17878
 [3,] 1.2838  0.728311 0.20805
 [4,] 1.0859 -0.440566 0.16173
 [5,] 1.1749 -0.045554 0.23987
 [6,] 1.1786  0.006729 0.22537
 [7,] 0.8680  1.019832 0.15020
 [8,] 1.4489 -0.435660 0.14789
 [9,] 1.4630  1.346885 0.12883
[10,] 0.5805 -0.130311 0.26612

$itempar
        [,1]     [,2]    [,3]
 [1,] 1.0833 -0.62881 0.18135
 [2,] 1.4569  0.35718 0.16981
 [3,] 1.4572  0.58300 0.15132
 [4,] 0.8332  0.77767 0.19911
 [5,] 0.7998  0.84951 0.07186
 [6,] 1.2964  1.40714 0.19965
 [7,] 1.0498  0.25638 0.23851
 [8,] 1.1080 -0.58124 0.16927
 [9,] 0.7451  0.08085 0.18025
[10,] 0.8302  0.61757 0.18997

$itempar
        [,1]     [,2]    [,3]
 [1,] 1.2428  0.38038 0.15683
 [2,] 0.9222  0.06897 0.14285
 [3,] 1.2159 -0.53983 0.08549
 [4,] 1.3092  0.47354 0.17746
 [5,] 1.0709 -0.15980 0.20135
 [6,] 0.8401  0.70899 0.20493
 [7,] 1.0457 -0.57915 0.19977
 [8,] 1.0311  0.96456 0.22195
 [9,] 1.4022 -0.48486 0.16690
[10,] 0.8243 -0.12529 0.11996</code></pre>
<p>This is a very simple example of how <code>lapply</code> and <code>sapply</code> work. Using the same structure, we could also estimate the item parameters with <code>mirt</code> and save all the results together.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1">data &lt;-<span class="st"> </span><span class="kw">lapply</span>(1L<span class="op">:</span>nreps, </a>
<a class="sourceLine" id="cb32-2" title="2">               <span class="cf">function</span>(i) x[,i][<span class="dv">4</span>]) <span class="co"># the 4th part is respdata</span></a>
<a class="sourceLine" id="cb32-3" title="3"></a>
<a class="sourceLine" id="cb32-4" title="4">models &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">lapply</span>(data, <span class="st">&#39;[[&#39;</span>, <span class="st">&#39;respdata&#39;</span>), <span class="co"># select respdata from each list</span></a>
<a class="sourceLine" id="cb32-5" title="5">                 <span class="cf">function</span>(i) mirt<span class="op">::</span><span class="kw">mirt</span>(<span class="dt">data =</span> i, <span class="dv">1</span>, <span class="dt">itemtype =</span> <span class="st">&quot;3PL&quot;</span>)) <span class="co"># apply mirt to respdata</span></a>
<a class="sourceLine" id="cb32-6" title="6"></a>
<a class="sourceLine" id="cb32-7" title="7">parameters &lt;-<span class="st"> </span><span class="kw">lapply</span>(models, </a>
<a class="sourceLine" id="cb32-8" title="8">                     <span class="cf">function</span>(x) mirt<span class="op">::</span><span class="kw">coef</span>(x, <span class="dt">IRTpars =</span> <span class="ot">TRUE</span>, <span class="dt">simplify =</span> <span class="ot">TRUE</span>)<span class="op">$</span>items[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])</a></code></pre></div>
</div>
<div id="loops" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Loops</h3>
<p>Loops in <code>R</code> are useful when:</p>
<ul>
<li>there is a series of functions to be executed and</li>
<li>the functions return a particular object (e.g., an integer, a data frame, or a matrix) that is necessary for the subsequent functions.</li>
</ul>
<p>There are several control statements essential for loops:</p>
<ul>
<li><code>if</code> and <code>else</code> for testing a condition and acting on it</li>
<li><code>for</code> for setting up and running a loop a fixed number of iterations</li>
<li><code>while</code> for executing a loop while a condition is true</li>
<li><code>break</code> for stopping the execution of a loop</li>
<li><code>next</code> for skipping an iteration of a loop</li>
</ul>
<p>Let’s take a quick look at how each of these control statements works:</p>
<p><strong>if-else statement</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="cf">if</span>(<span class="op">&lt;</span>condition1<span class="op">&gt;</span>) {</a>
<a class="sourceLine" id="cb33-2" title="2">  <span class="co">## do action #1</span></a>
<a class="sourceLine" id="cb33-3" title="3">  } <span class="cf">else</span> <span class="cf">if</span>(<span class="op">&lt;</span>condition2<span class="op">&gt;</span>)  {</a>
<a class="sourceLine" id="cb33-4" title="4">    <span class="co">## do action #2</span></a>
<a class="sourceLine" id="cb33-5" title="5">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb33-6" title="6">      <span class="co">## do action #3</span></a>
<a class="sourceLine" id="cb33-7" title="7">      }</a></code></pre></div>
<p><strong>for statement</strong></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1"><span class="cf">for</span>(<span class="op">&lt;</span>index1<span class="op">&gt;</span><span class="st"> </span><span class="cf">in</span> <span class="op">&lt;</span>values of index1<span class="op">&gt;</span>) {</a>
<a class="sourceLine" id="cb34-2" title="2">  <span class="cf">for</span>(<span class="op">&lt;</span>index2<span class="op">&gt;</span><span class="st"> </span><span class="cf">in</span> <span class="op">&lt;</span>values of index2<span class="op">&gt;</span>) {</a>
<a class="sourceLine" id="cb34-3" title="3">    <span class="co">## do an action for each index1 and index2</span></a>
<a class="sourceLine" id="cb34-4" title="4">  }</a>
<a class="sourceLine" id="cb34-5" title="5">}</a></code></pre></div>
<p><strong>while statement</strong></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="cf">while</span>(<span class="op">&lt;</span>condition<span class="op">&gt;</span>) {</a>
<a class="sourceLine" id="cb35-2" title="2">  <span class="co">## do an action while condition == TRUE</span></a>
<a class="sourceLine" id="cb35-3" title="3">}</a></code></pre></div>
<p><strong>break statement</strong></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1"><span class="cf">for</span>(<span class="op">&lt;</span>index<span class="op">&gt;</span><span class="st"> </span><span class="cf">in</span> <span class="op">&lt;</span>values of index<span class="op">&gt;</span>) {</a>
<a class="sourceLine" id="cb36-2" title="2">  <span class="co">## do an action for each index</span></a>
<a class="sourceLine" id="cb36-3" title="3">  <span class="cf">if</span>(<span class="op">&lt;</span>condition<span class="op">&gt;</span>) {</a>
<a class="sourceLine" id="cb36-4" title="4">    <span class="cf">break</span> <span class="co"># Stop the action if condition == TRUE</span></a>
<a class="sourceLine" id="cb36-5" title="5">  }</a>
<a class="sourceLine" id="cb36-6" title="6">}</a></code></pre></div>
<p><strong>next statement</strong></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="cf">for</span>(<span class="op">&lt;</span>index<span class="op">&gt;</span><span class="st"> </span><span class="cf">in</span> <span class="op">&lt;</span>values of index<span class="op">&gt;</span>) {</a>
<a class="sourceLine" id="cb37-2" title="2">  <span class="cf">if</span>(<span class="op">&lt;</span>condition<span class="op">&gt;</span>) {</a>
<a class="sourceLine" id="cb37-3" title="3">    <span class="cf">next</span> <span class="co">## Skip the action if condition == TRUE</span></a>
<a class="sourceLine" id="cb37-4" title="4">  }</a>
<a class="sourceLine" id="cb37-5" title="5">  <span class="co">## do an action for each index</span></a>
<a class="sourceLine" id="cb37-6" title="6">}</a></code></pre></div>
<p>In general, loops are very useful in Monte Carlo simulations; however, they can be very slow when:</p>
<ul>
<li>we are dealing with heavy computations</li>
<li>we apply a function to each row or column of a large data set</li>
</ul>
<p>Therefore, compared with traditional <code>for</code> loops, the <code>apply</code> function collection is often more preferable because it can run a computation and return its results much more quickly.</p>
</div>
<div id="parallel-computing" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Parallel Computing</h3>
<p>In some computations, creating a loop might be necessary. The regular <code>for</code> loop statement executes all the functions using a single processor in the computer. Similarly, the <code>apply</code> function collection also utilizes a single processor in the computer. The use of a single processor is the default setting in <code>R</code>. That is, regardless of whether we are using a 64-bit version of <code>R</code> in a multi-core, powerful computer, <code>R</code> always uses only <strong>one</strong> processor by default.</p>
<p>For example, in a simulation study with 100 replications via <code>for</code> loops, a single processor would have to run each iteration one by one and return the results once all replications are completed. This may not be a problem especially if we are running a very simple simulation. However, completing a simulation study involving heavy computations for each replication, using a single processor could be very time consuming. Fortunately, there is a solution to this problem: <strong>parallel computing</strong><a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>.</p>
<p>To benefit from parallel computing when running a Monte Carlo simulation study, we will use two packages: <code>foreach</code> <span class="citation">(Microsoft and Weston <a href="#ref-R-foreach" role="doc-biblioref">2020</a>)</span> and <code>doParallel</code> <span class="citation">(Corporation and Weston <a href="#ref-R-doParallel" role="doc-biblioref">2019</a><a href="#ref-R-doParallel" role="doc-biblioref">b</a>)</span>. <code>doParallel</code> essentially provides a mechanism
needed to execute <code>foreach</code> loops in parallel computing (see the <a href="https://cran.r-project.org/web/packages/doParallel/vignettes/gettingstartedParallel.pdf">vignette</a> for the <code>doParallel</code> package).</p>
<p>There are several steps in setting up parallel computing with <code>doParallel</code>:</p>
<ol style="list-style-type: decimal">
<li>Make clusters for parallel computing</li>
<li>Register clusters with <code>doParallel</code></li>
<li>Run <code>foreach</code> loops using parallel computing.</li>
</ol>
<p>Now, let’s take a look at a short example. First, we will activate <code>doParallel</code>. Next, we will check how many processors (i.e., cores) are available in our computer. The number of processors is the maximum number that we can use when setting up parallel computing. This would use all the processors available, though it also slows down the computer significantly and prevents us from doing other tasks in the computer. If this is a concern, then we can assign fewer processors (instead of all of them) to parallel computing.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1"><span class="kw">library</span>(<span class="st">&quot;doParallel&quot;</span>)</a>
<a class="sourceLine" id="cb38-2" title="2"><span class="kw">detectCores</span>()</a></code></pre></div>
<pre><code>[1] 16</code></pre>
<p>It seems that there are 16 processors available. We want to use 4 of these processors for running parallel loops<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1">cl &lt;-<span class="st"> </span><span class="kw">makeCluster</span>(<span class="dv">4</span>) <span class="co"># Register four clusters (Windows)</span></a>
<a class="sourceLine" id="cb40-2" title="2"><span class="kw">registerDoParallel</span>(cl)</a></code></pre></div>
<p>In a <code>foreach</code> loop, there are two ways that a loop can be set up: <code>%do%</code> for a regular loop and <code>%dopar%</code> for running the same code sequentially through multiple processors. In the following example, we will use <code>%dopar%</code>.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1"><span class="kw">foreach</span>(<span class="dt">i=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) <span class="op">%dopar%</span><span class="st"> </span><span class="kw">sqrt</span>(i)</a>
<a class="sourceLine" id="cb41-2" title="2"><span class="kw">stopCluster</span>(cl) <span class="co"># Stop using clusters</span></a></code></pre></div>
<p>Once the simulation is over, we will turn off the clusters.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1"><span class="kw">stopCluster</span>(cl) <span class="co"># Stop using clusters</span></a></code></pre></div>
<p>In this small example, it is hard to see the impact of parallel computing. Parallel computing will show its strengths more clearly when we check the computing time (i.e., running time) of our codes. We will talk about this in the next section.</p>
<p>To demonstrate how to put all the simulation functions together, we will combine the custom functions and run them together within a loop. First, we will run the latest (i.e., tested) versions of our custom functions:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1"><span class="co"># Function #1</span></a>
<a class="sourceLine" id="cb43-2" title="2">generate_data &lt;-<span class="st"> </span><span class="cf">function</span>(nitem, nexaminee, <span class="dt">seed =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb43-3" title="3">  </a>
<a class="sourceLine" id="cb43-4" title="4">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(seed)) {</a>
<a class="sourceLine" id="cb43-5" title="5">    <span class="kw">set.seed</span>(seed)} </a>
<a class="sourceLine" id="cb43-6" title="6">  <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb43-7" title="7">    <span class="kw">warning</span>(<span class="st">&quot;No seed provided!&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb43-8" title="8">    seed &lt;-<span class="st"> </span><span class="kw">sample.int</span>(<span class="dv">10000</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb43-9" title="9">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb43-10" title="10">    <span class="kw">message</span>(<span class="st">&quot;Random seed = &quot;</span>, seed, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb43-11" title="11">  }</a>
<a class="sourceLine" id="cb43-12" title="12">  </a>
<a class="sourceLine" id="cb43-13" title="13">  itempar &lt;-<span class="st"> </span><span class="kw">cbind</span>(</a>
<a class="sourceLine" id="cb43-14" title="14">    <span class="kw">rnorm</span>(nitem, <span class="dt">mean =</span> <span class="fl">1.13</span>, <span class="dt">sd =</span> <span class="fl">0.25</span>), <span class="co">#a</span></a>
<a class="sourceLine" id="cb43-15" title="15">    <span class="kw">rnorm</span>(nitem, <span class="dt">mean =</span> <span class="fl">0.21</span>, <span class="dt">sd =</span> <span class="fl">0.51</span>), <span class="co">#b</span></a>
<a class="sourceLine" id="cb43-16" title="16">    <span class="kw">rnorm</span>(nitem, <span class="dt">mean =</span> <span class="fl">0.16</span>, <span class="dt">sd =</span> <span class="fl">0.05</span>)) <span class="co">#c</span></a>
<a class="sourceLine" id="cb43-17" title="17">  </a>
<a class="sourceLine" id="cb43-18" title="18">  ability &lt;-<span class="st"> </span><span class="kw">rnorm</span>(nexaminee, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb43-19" title="19">  </a>
<a class="sourceLine" id="cb43-20" title="20">  respdata &lt;-<span class="st"> </span>irtoys<span class="op">::</span><span class="kw">sim</span>(<span class="dt">ip =</span> itempar, <span class="dt">x =</span> ability)</a>
<a class="sourceLine" id="cb43-21" title="21">  <span class="kw">colnames</span>(respdata) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;item&quot;</span>, <span class="dv">1</span><span class="op">:</span>nitem)</a>
<a class="sourceLine" id="cb43-22" title="22">  </a>
<a class="sourceLine" id="cb43-23" title="23">  data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">itempar =</span> itempar,</a>
<a class="sourceLine" id="cb43-24" title="24">               <span class="dt">ability =</span> ability,</a>
<a class="sourceLine" id="cb43-25" title="25">               <span class="dt">seed =</span> seed,</a>
<a class="sourceLine" id="cb43-26" title="26">               <span class="dt">respdata =</span> respdata)</a>
<a class="sourceLine" id="cb43-27" title="27">  </a>
<a class="sourceLine" id="cb43-28" title="28">  <span class="kw">return</span>(data)</a>
<a class="sourceLine" id="cb43-29" title="29">}</a>
<a class="sourceLine" id="cb43-30" title="30"></a>
<a class="sourceLine" id="cb43-31" title="31"><span class="co"># Function 2</span></a>
<a class="sourceLine" id="cb43-32" title="32">estimate_par &lt;-<span class="st"> </span><span class="cf">function</span>(data, <span class="dt">guess =</span> <span class="dv">-1</span>) {</a>
<a class="sourceLine" id="cb43-33" title="33">  <span class="co"># If guessing is fixed</span></a>
<a class="sourceLine" id="cb43-34" title="34">  <span class="cf">if</span>(guess <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb43-35" title="35">    </a>
<a class="sourceLine" id="cb43-36" title="36">    <span class="co"># Model set up</span></a>
<a class="sourceLine" id="cb43-37" title="37">    mod3PL &lt;-<span class="st"> </span>mirt<span class="op">::</span><span class="kw">mirt</span>(data, <span class="co"># response data</span></a>
<a class="sourceLine" id="cb43-38" title="38">                         <span class="dv">1</span>,    <span class="co"># unidimensional model</span></a>
<a class="sourceLine" id="cb43-39" title="39">                         <span class="dt">guess =</span> guess, <span class="co"># fixed guessing</span></a>
<a class="sourceLine" id="cb43-40" title="40">                         <span class="dt">verbose =</span> <span class="ot">FALSE</span>, <span class="co"># Don&#39;t print verbose</span></a>
<a class="sourceLine" id="cb43-41" title="41">                         <span class="co"># Increase the number of EM cycles</span></a>
<a class="sourceLine" id="cb43-42" title="42">                         <span class="co"># Turn off estimation messages</span></a>
<a class="sourceLine" id="cb43-43" title="43">                         <span class="dt">technical =</span> <span class="kw">list</span>(<span class="dt">NCYCLES =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb43-44" title="44">                                          <span class="dt">message =</span> <span class="ot">FALSE</span>)) </a>
<a class="sourceLine" id="cb43-45" title="45">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb43-46" title="46">    mod3PL &lt;-<span class="st"> </span>mirt<span class="op">::</span><span class="kw">mirt</span>(data, <span class="co"># response data</span></a>
<a class="sourceLine" id="cb43-47" title="47">                         <span class="dv">1</span>,    <span class="co"># unidimensional model</span></a>
<a class="sourceLine" id="cb43-48" title="48">                         <span class="dt">itemtype =</span> <span class="st">&quot;3PL&quot;</span>, <span class="co"># IRT model</span></a>
<a class="sourceLine" id="cb43-49" title="49">                         <span class="dt">verbose =</span> <span class="ot">FALSE</span>, <span class="co"># Don&#39;t print verbose</span></a>
<a class="sourceLine" id="cb43-50" title="50">                         <span class="co"># Increase the number of EM cycles</span></a>
<a class="sourceLine" id="cb43-51" title="51">                         <span class="co"># Turn off estimation messages</span></a>
<a class="sourceLine" id="cb43-52" title="52">                         <span class="dt">technical =</span> <span class="kw">list</span>(<span class="dt">NCYCLES =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb43-53" title="53">                                          <span class="dt">message =</span> <span class="ot">FALSE</span>)) </a>
<a class="sourceLine" id="cb43-54" title="54">  }</a>
<a class="sourceLine" id="cb43-55" title="55">  </a>
<a class="sourceLine" id="cb43-56" title="56">  <span class="co"># Extract item parameters in typical IRT metric</span></a>
<a class="sourceLine" id="cb43-57" title="57">  itempar_est &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(mirt<span class="op">::</span><span class="kw">coef</span>(mod3PL, <span class="dt">IRTpars =</span> <span class="ot">TRUE</span>, <span class="dt">simplify =</span> <span class="ot">TRUE</span>)<span class="op">$</span>item[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])</a>
<a class="sourceLine" id="cb43-58" title="58">  <span class="kw">return</span>(itempar_est)</a>
<a class="sourceLine" id="cb43-59" title="59">}</a>
<a class="sourceLine" id="cb43-60" title="60"></a>
<a class="sourceLine" id="cb43-61" title="61"><span class="co"># Function #3</span></a>
<a class="sourceLine" id="cb43-62" title="62">summarize &lt;-<span class="st"> </span><span class="cf">function</span>(est_params, true_params) {</a>
<a class="sourceLine" id="cb43-63" title="63">  result &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb43-64" title="64">    <span class="dt">parameter =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>),</a>
<a class="sourceLine" id="cb43-65" title="65">    <span class="dt">bias =</span> <span class="kw">sapply</span>(1L<span class="op">:</span>3L, <span class="cf">function</span>(i) <span class="kw">mean</span>((est_params[, i] <span class="op">-</span><span class="st"> </span>true_params[,i]))),</a>
<a class="sourceLine" id="cb43-66" title="66">    <span class="dt">rmse =</span> <span class="kw">sapply</span>(1L<span class="op">:</span>3L, <span class="cf">function</span>(i) <span class="kw">sqrt</span>(<span class="kw">mean</span>((est_params[, i] <span class="op">-</span><span class="st"> </span>true_params[,i])<span class="op">^</span><span class="dv">2</span>))),</a>
<a class="sourceLine" id="cb43-67" title="67">    <span class="dt">correlation =</span> <span class="kw">sapply</span>(1L<span class="op">:</span>3L, <span class="cf">function</span>(i) <span class="kw">cor</span>(est_params[, i], true_params[,i])))</a>
<a class="sourceLine" id="cb43-68" title="68">  <span class="kw">return</span>(result)</a>
<a class="sourceLine" id="cb43-69" title="69">}</a></code></pre></div>
<p>Second, we will set up our simulation conditions so that it would be easier to update them as we run all the conditions. Note that the number of iterations (i.e., replications) is only 4 for now. If the functions work as expected, we will increase the number of iterations to 100.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1">iterations =<span class="st"> </span><span class="dv">4</span> <span class="co"># Only 4 iteration for now</span></a>
<a class="sourceLine" id="cb44-2" title="2">seed =<span class="st"> </span><span class="kw">sample.int</span>(<span class="dv">10000</span>, <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb44-3" title="3">nitem =<span class="st"> </span><span class="dv">10</span> <span class="co"># 10, 15, 20, or 25</span></a>
<a class="sourceLine" id="cb44-4" title="4">nexaminee =<span class="st"> </span><span class="dv">1000</span> <span class="co"># 250, 500, 750, or 1000</span></a>
<a class="sourceLine" id="cb44-5" title="5">guess =<span class="st"> </span><span class="dv">-1</span> <span class="co"># A negative value or a value from 0 to 1</span></a></code></pre></div>
<p>Third, we will set up parallel computing and register multiple processors for the simulation.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1">cl &lt;-<span class="st"> </span><span class="kw">makeCluster</span>(<span class="dv">4</span>) <span class="co"># Register four clusters</span></a>
<a class="sourceLine" id="cb45-2" title="2"><span class="kw">registerDoParallel</span>(cl)</a></code></pre></div>
<p>Finally, we will run our simulation and save the results as <code>simresults</code>.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1">simresults &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i=</span><span class="dv">1</span><span class="op">:</span>iterations, </a>
<a class="sourceLine" id="cb46-2" title="2">                      <span class="dt">.packages =</span> <span class="kw">c</span>(<span class="st">&quot;mirt&quot;</span>, <span class="st">&quot;doParallel&quot;</span>),</a>
<a class="sourceLine" id="cb46-3" title="3">                      <span class="dt">.combine =</span> rbind) <span class="op">%dopar%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb46-4" title="4">                        <span class="co"># Generate item parameters and data</span></a>
<a class="sourceLine" id="cb46-5" title="5">                        step1 &lt;-<span class="st"> </span><span class="kw">generate_data</span>(<span class="dt">nitem=</span>nitem, <span class="dt">nexaminee=</span>nexaminee, <span class="dt">seed=</span>seed[i])</a>
<a class="sourceLine" id="cb46-6" title="6">                        <span class="co"># Estimate item parameters</span></a>
<a class="sourceLine" id="cb46-7" title="7">                        step2 &lt;-<span class="st"> </span><span class="kw">estimate_par</span>(step1<span class="op">$</span>respdata, <span class="dt">guess =</span> guess)</a>
<a class="sourceLine" id="cb46-8" title="8">                        <span class="co"># Summarize results</span></a>
<a class="sourceLine" id="cb46-9" title="9">                        <span class="kw">summarize</span>(step2, step1<span class="op">$</span>itempar)</a>
<a class="sourceLine" id="cb46-10" title="10">                        } </a></code></pre></div>
<p>Now, we can see the results (assuming no error messages appeared on our console):</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1">simresults</a></code></pre></div>
<pre><code>   parameter      bias   rmse correlation
1          a  0.128163 0.3748     0.78904
2          b -0.059314 0.5941     0.62520
3          c -0.025765 0.1377     0.24511
4          a -0.030007 0.3135     0.49103
5          b -0.244383 0.4692     0.88362
6          c -0.052045 0.1444    -0.27393
7          a  0.199876 0.7391    -0.08689
8          b  0.017008 0.2874     0.82013
9          c  0.002217 0.1187     0.13883
10         a  0.310501 0.4886     0.78836
11         b  0.129384 0.3310     0.84102
12         c  0.072968 0.1203     0.42944</code></pre>
<p>Remember that this is only for <strong>one</strong> of the crossed conditions (10 items, 1000 examinees, no fixed guessing) across <strong>four</strong> iterations. We can summarize the results across all iterations, add additional information to remind us what we have done in the simulation, and save the results. We will use the <code>dplyr</code> package <span class="citation">(Wickham et al. <a href="#ref-R-dplyr" role="doc-biblioref">2020</a>)</span> for summarizing our simulation results.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1"><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</a>
<a class="sourceLine" id="cb49-2" title="2"></a>
<a class="sourceLine" id="cb49-3" title="3">simresults_final &lt;-<span class="st"> </span>simresults <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb49-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(parameter) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb49-5" title="5"><span class="st">  </span><span class="co"># Find the average and rounded values </span></a>
<a class="sourceLine" id="cb49-6" title="6"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">bias =</span> <span class="kw">round</span>(<span class="kw">mean</span>(bias),<span class="dv">3</span>),</a>
<a class="sourceLine" id="cb49-7" title="7">            <span class="dt">rmse =</span> <span class="kw">round</span>(<span class="kw">mean</span>(rmse),<span class="dv">3</span>),</a>
<a class="sourceLine" id="cb49-8" title="8">            <span class="dt">correlation =</span> <span class="kw">round</span>(<span class="kw">mean</span>(correlation),<span class="dv">3</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb49-9" title="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">nitem =</span> nitem,</a>
<a class="sourceLine" id="cb49-10" title="10">         <span class="dt">nexaminee =</span> nexaminee,</a>
<a class="sourceLine" id="cb49-11" title="11">         <span class="dt">guess =</span> guess) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb49-12" title="12"><span class="st">  </span><span class="kw">select</span>(nitem, nexaminee, guess, parameter, bias, rmse, correlation) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb49-13" title="13"><span class="st">  </span><span class="kw">as.data.frame</span>()</a>
<a class="sourceLine" id="cb49-14" title="14"></a>
<a class="sourceLine" id="cb49-15" title="15">simresults_final</a></code></pre></div>
<pre><code>  nitem nexaminee guess parameter   bias  rmse correlation
1    10      1000    -1         a  0.152 0.479       0.495
2    10      1000    -1         b -0.039 0.420       0.792
3    10      1000    -1         c -0.001 0.130       0.135</code></pre>
<p>We can also create a nested loop where we can all the conditions together. Here we use <code>%:%</code> to set up three nested loops without curly brackets. The final loop contains <code>%dopar%</code> with curly brackets and closes all the loops. Note that we included the final summary function (see how <code>step3</code> is summarized) inside these nested loops. This will return a long-format summary data set with all the conditions based on <strong>100</strong> iterations.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1"><span class="co"># Set all the conditions</span></a>
<a class="sourceLine" id="cb51-2" title="2">iterations =<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb51-3" title="3">seed =<span class="st"> </span><span class="kw">sample.int</span>(<span class="dv">10000</span>, <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb51-4" title="4">nitem =<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>)</a>
<a class="sourceLine" id="cb51-5" title="5">nexaminee =<span class="st"> </span><span class="kw">c</span>(<span class="dv">250</span>, <span class="dv">500</span>, <span class="dv">750</span>, <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb51-6" title="6">guess =<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.16</span>)</a>
<a class="sourceLine" id="cb51-7" title="7"></a>
<a class="sourceLine" id="cb51-8" title="8"><span class="co"># Register four clusters</span></a>
<a class="sourceLine" id="cb51-9" title="9">cl &lt;-<span class="st"> </span><span class="kw">makeCluster</span>(<span class="dv">4</span>) </a>
<a class="sourceLine" id="cb51-10" title="10"><span class="kw">registerDoParallel</span>(cl)</a>
<a class="sourceLine" id="cb51-11" title="11"></a>
<a class="sourceLine" id="cb51-12" title="12"><span class="co"># Run nested foreach loops</span></a>
<a class="sourceLine" id="cb51-13" title="13">simresults &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i=</span><span class="dv">1</span><span class="op">:</span>iterations, </a>
<a class="sourceLine" id="cb51-14" title="14">                      <span class="dt">.packages =</span> <span class="kw">c</span>(<span class="st">&quot;mirt&quot;</span>, <span class="st">&quot;doParallel&quot;</span>, <span class="st">&quot;dplyr&quot;</span>),</a>
<a class="sourceLine" id="cb51-15" title="15">                      <span class="dt">.combine =</span> rbind) <span class="op">%:%</span></a>
<a class="sourceLine" id="cb51-16" title="16"><span class="st">  </span><span class="kw">foreach</span>(<span class="dt">j=</span>nitem, </a>
<a class="sourceLine" id="cb51-17" title="17">          <span class="dt">.packages =</span> <span class="kw">c</span>(<span class="st">&quot;mirt&quot;</span>, <span class="st">&quot;doParallel&quot;</span>, <span class="st">&quot;dplyr&quot;</span>),</a>
<a class="sourceLine" id="cb51-18" title="18">          <span class="dt">.combine =</span> rbind)  <span class="op">%:%</span></a>
<a class="sourceLine" id="cb51-19" title="19"><span class="st">  </span></a>
<a class="sourceLine" id="cb51-20" title="20"><span class="st"> </span><span class="kw">foreach</span>(<span class="dt">k=</span>nexaminee, </a>
<a class="sourceLine" id="cb51-21" title="21">          <span class="dt">.packages =</span> <span class="kw">c</span>(<span class="st">&quot;mirt&quot;</span>, <span class="st">&quot;doParallel&quot;</span>, <span class="st">&quot;dplyr&quot;</span>),</a>
<a class="sourceLine" id="cb51-22" title="22">          <span class="dt">.combine =</span> rbind)  <span class="op">%:%</span></a>
<a class="sourceLine" id="cb51-23" title="23"><span class="st">  </span></a>
<a class="sourceLine" id="cb51-24" title="24"><span class="st">  </span><span class="kw">foreach</span>(<span class="dt">m=</span>guess, </a>
<a class="sourceLine" id="cb51-25" title="25">          <span class="dt">.packages =</span> <span class="kw">c</span>(<span class="st">&quot;mirt&quot;</span>, <span class="st">&quot;doParallel&quot;</span>, <span class="st">&quot;dplyr&quot;</span>),</a>
<a class="sourceLine" id="cb51-26" title="26">          <span class="dt">.combine =</span> rbind)  <span class="op">%dopar%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb51-27" title="27">            <span class="co"># Generate item parameters and data</span></a>
<a class="sourceLine" id="cb51-28" title="28">            step1 &lt;-<span class="st"> </span><span class="kw">generate_data</span>(<span class="dt">nitem=</span>j, <span class="dt">nexaminee=</span>k, <span class="dt">seed=</span>seed[i])</a>
<a class="sourceLine" id="cb51-29" title="29">            <span class="co"># Estimate item parameters</span></a>
<a class="sourceLine" id="cb51-30" title="30">            step2 &lt;-<span class="st"> </span><span class="kw">estimate_par</span>(step1<span class="op">$</span>respdata, <span class="dt">guess =</span> m)</a>
<a class="sourceLine" id="cb51-31" title="31">            <span class="co"># Summarize results</span></a>
<a class="sourceLine" id="cb51-32" title="32">            step3 &lt;-<span class="st"> </span><span class="kw">summarize</span>(step2, step1<span class="op">$</span>itempar)</a>
<a class="sourceLine" id="cb51-33" title="33">            <span class="co"># Finalize results</span></a>
<a class="sourceLine" id="cb51-34" title="34">            step3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-35" title="35"><span class="st">              </span><span class="kw">group_by</span>(parameter) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-36" title="36"><span class="st">              </span><span class="kw">summarise</span>(<span class="dt">bias =</span> <span class="kw">round</span>(<span class="kw">mean</span>(bias),<span class="dv">3</span>),</a>
<a class="sourceLine" id="cb51-37" title="37">                        <span class="dt">rmse =</span> <span class="kw">round</span>(<span class="kw">mean</span>(rmse),<span class="dv">3</span>),</a>
<a class="sourceLine" id="cb51-38" title="38">                        <span class="dt">correlation =</span> <span class="kw">round</span>(<span class="kw">mean</span>(correlation),<span class="dv">3</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-39" title="39"><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">nitem =</span> j,</a>
<a class="sourceLine" id="cb51-40" title="40">                     <span class="dt">nexaminee =</span> k,</a>
<a class="sourceLine" id="cb51-41" title="41">                     <span class="dt">guess =</span> m) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-42" title="42"><span class="st">              </span><span class="kw">select</span>(nitem, nexaminee, guess, parameter, bias, rmse, correlation) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-43" title="43"><span class="st">              </span><span class="kw">as.data.frame</span>()</a>
<a class="sourceLine" id="cb51-44" title="44">          }</a>
<a class="sourceLine" id="cb51-45" title="45"></a>
<a class="sourceLine" id="cb51-46" title="46"><span class="co"># Stop the clusters</span></a>
<a class="sourceLine" id="cb51-47" title="47"><span class="kw">stopCluster</span>(cl)</a></code></pre></div>
<hr />
<p>If you are interested in high performance computing, I also recommend the following resources:</p>
<ul>
<li>Lim and Tjhi’s book: <a href="https://www.packtpub.com/application-development/r-high-performance-programming">R High Performance Programming</a></li>
<li>The <a href="http://adv-r.had.co.nz/Performance.html">Performance</a> chapter in Hadley Wickham’s <a href="http://adv-r.had.co.nz/">Advanced R</a> book</li>
</ul>
<hr />
</div>
</div>
<div id="benchmarking" class="section level2">
<h2><span class="header-section-number">3.4</span> Benchmarking</h2>
<p>There are several options to measure running time of a Monte Carlo simulation in <code>R</code>.</p>
<ol style="list-style-type: decimal">
<li>Functions included in base <code>R</code>:</li>
</ol>
<ul>
<li><code>system.time()</code></li>
<li><code>Sys.time()</code></li>
<li><code>Rprof()</code> and <code>summaryRprof()</code></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Packages on benchmarking</li>
</ol>
<ul>
<li>The <code>tictoc</code> package <span class="citation">(Izrailev <a href="#ref-R-tictoc" role="doc-biblioref">2020</a>)</span></li>
<li>The <code>rbenchmark</code> package <span class="citation">(Kusnierczyk <a href="#ref-R-rbenchmark" role="doc-biblioref">2012</a>)</span></li>
<li>The <code>microbenchmark</code> package <span class="citation">(Mersmann <a href="#ref-R-microbenchmark" role="doc-biblioref">2019</a>)</span></li>
<li>The <code>bench</code> package <span class="citation">(Hester <a href="#ref-R-bench" role="doc-biblioref">2020</a>)</span> (check out its <a href="https://github.com/r-lib/bench">website</a>)</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Progress bar with <code>txtProgressBar</code> and <code>doSNOW</code> <span class="citation">(Corporation and Weston <a href="#ref-R-doSNOW" role="doc-biblioref">2019</a><a href="#ref-R-doSNOW" role="doc-biblioref">a</a>)</span></li>
</ol>
<p>The three packages, <code>rbenchmark</code>, <code>microbenchmark</code>, and <code>bench</code>, provide detailed information about running time as well as memory usage in <code>R</code>. Furthermore, <code>microbenchmark</code> and <code>bench</code> are capable of visualizing benchmarking results (utilizing <code>ggplot2</code>). For more information on benchmarking in <code>R</code>, I recommend you to check out <a href="https://www.alexejgossmann.com/benchmarking_r/">this nice blog post</a>.</p>
<p>In the following example, we will run a simple benchmarking test using our simulation. We will use <code>%do%</code> and <code>%dopar%</code> to see the difference. We will use both <code>system.time</code> and <code>Sys.time</code> together.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1">iterations =<span class="st"> </span><span class="dv">4</span> <span class="co">#Eventually this will be 100</span></a>
<a class="sourceLine" id="cb52-2" title="2">seed =<span class="st"> </span><span class="kw">sample.int</span>(<span class="dv">10000</span>, <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb52-3" title="3">nitem =<span class="st"> </span><span class="dv">10</span> <span class="co">#10, 15, 20, or 25</span></a>
<a class="sourceLine" id="cb52-4" title="4">nexaminee =<span class="st"> </span><span class="dv">1000</span> <span class="co">#250, 500, 750, or 1000</span></a>
<a class="sourceLine" id="cb52-5" title="5">guess =<span class="st"> </span><span class="dv">-1</span> <span class="co"># A negative value or a value from 0 to 1</span></a>
<a class="sourceLine" id="cb52-6" title="6"></a>
<a class="sourceLine" id="cb52-7" title="7"><span class="co"># No parallel computing</span></a>
<a class="sourceLine" id="cb52-8" title="8">start_time &lt;-<span class="st"> </span><span class="kw">Sys.time</span>() <span class="co"># Starting time</span></a>
<a class="sourceLine" id="cb52-9" title="9"><span class="kw">system.time</span>(</a>
<a class="sourceLine" id="cb52-10" title="10">  simresults &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i=</span><span class="dv">1</span><span class="op">:</span>iterations, </a>
<a class="sourceLine" id="cb52-11" title="11">                        <span class="dt">.packages =</span> <span class="kw">c</span>(<span class="st">&quot;mirt&quot;</span>, <span class="st">&quot;doParallel&quot;</span>),</a>
<a class="sourceLine" id="cb52-12" title="12">                        <span class="dt">.combine =</span> rbind) <span class="op">%do%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb52-13" title="13">                          <span class="co"># Generate item parameters and data</span></a>
<a class="sourceLine" id="cb52-14" title="14">                          step1 &lt;-<span class="st"> </span><span class="kw">generate_data</span>(<span class="dt">nitem=</span>nitem, <span class="dt">nexaminee=</span>nexaminee, <span class="dt">seed=</span>seed[i])</a>
<a class="sourceLine" id="cb52-15" title="15">                          <span class="co"># Estimate item parameters</span></a>
<a class="sourceLine" id="cb52-16" title="16">                          step2 &lt;-<span class="st"> </span><span class="kw">estimate_par</span>(step1<span class="op">$</span>respdata, <span class="dt">guess =</span> guess)</a>
<a class="sourceLine" id="cb52-17" title="17">                          <span class="co"># Summarize results</span></a>
<a class="sourceLine" id="cb52-18" title="18">                          <span class="kw">summarize</span>(step2, step1<span class="op">$</span>itempar)</a>
<a class="sourceLine" id="cb52-19" title="19">                        }</a>
<a class="sourceLine" id="cb52-20" title="20">)</a></code></pre></div>
<pre><code>   user  system elapsed 
  10.06    0.08   10.15 </code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" title="1">end_time &lt;-<span class="st"> </span><span class="kw">Sys.time</span>() <span class="co"># End time</span></a>
<a class="sourceLine" id="cb54-2" title="2">end_time <span class="op">-</span><span class="st"> </span>start_time <span class="co"># Time difference</span></a></code></pre></div>
<pre><code>Time difference of 10.3 secs</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" title="1"><span class="co"># With parallel computing</span></a>
<a class="sourceLine" id="cb56-2" title="2">start_time &lt;-<span class="st"> </span><span class="kw">Sys.time</span>() <span class="co"># Starting time</span></a>
<a class="sourceLine" id="cb56-3" title="3"><span class="kw">system.time</span>(</a>
<a class="sourceLine" id="cb56-4" title="4">  simresults &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i=</span><span class="dv">1</span><span class="op">:</span>iterations, </a>
<a class="sourceLine" id="cb56-5" title="5">                        <span class="dt">.packages =</span> <span class="kw">c</span>(<span class="st">&quot;mirt&quot;</span>, <span class="st">&quot;doParallel&quot;</span>),</a>
<a class="sourceLine" id="cb56-6" title="6">                        <span class="dt">.combine =</span> rbind) <span class="op">%dopar%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb56-7" title="7">                          <span class="co"># Generate item parameters and data</span></a>
<a class="sourceLine" id="cb56-8" title="8">                          step1 &lt;-<span class="st"> </span><span class="kw">generate_data</span>(<span class="dt">nitem=</span>nitem, <span class="dt">nexaminee=</span>nexaminee, <span class="dt">seed=</span>seed[i])</a>
<a class="sourceLine" id="cb56-9" title="9">                          <span class="co"># Estimate item parameters</span></a>
<a class="sourceLine" id="cb56-10" title="10">                          step2 &lt;-<span class="st"> </span><span class="kw">estimate_par</span>(step1<span class="op">$</span>respdata, <span class="dt">guess =</span> guess)</a>
<a class="sourceLine" id="cb56-11" title="11">                          <span class="co"># Summarize results</span></a>
<a class="sourceLine" id="cb56-12" title="12">                          <span class="kw">summarize</span>(step2, step1<span class="op">$</span>itempar)</a>
<a class="sourceLine" id="cb56-13" title="13">                        }</a>
<a class="sourceLine" id="cb56-14" title="14">  </a>
<a class="sourceLine" id="cb56-15" title="15">)</a></code></pre></div>
<pre><code>   user  system elapsed 
   0.01    0.02    3.64 </code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" title="1">end_time &lt;-<span class="st"> </span><span class="kw">Sys.time</span>() <span class="co"># End time</span></a>
<a class="sourceLine" id="cb58-2" title="2">end_time <span class="op">-</span><span class="st"> </span>start_time <span class="co"># Time difference</span></a></code></pre></div>
<pre><code>Time difference of 3.792 secs</code></pre>
<p>In the output returned from <code>system.time</code>, “elapsed” is the time taken to execute the entire process, “user” gives the CPU time spent by the current process (i.e., the current R session), and “system” gives the CPU time spent by the kernel (the operating system) on behalf of the current process (see <a href="https://r.789695.n4.nabble.com/Meaning-of-proc-time-td2303263.html#a2306691">this post</a> on R-help mailing list for further information).</p>
<p>What if we want to see the time taken by each function in the whole simulation? <code>Rprof()</code> provides us with this type of information. To activate profiling in <code>R</code>, we need to run:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" title="1"><span class="kw">Rprof</span>()</a></code></pre></div>
<p>Then, we can see the running time of each function after profiling has been activated. We can use <code>summaryRprof()</code> to export the results at the end. We wil do this step for a single iteration to see the time distribution across all functions<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" title="1"><span class="kw">Rprof</span>() <span class="co"># Turn on profiling</span></a>
<a class="sourceLine" id="cb61-2" title="2"><span class="co"># Generate item parameters and data</span></a>
<a class="sourceLine" id="cb61-3" title="3">step1 &lt;-<span class="st"> </span><span class="kw">generate_data</span>(<span class="dt">nitem=</span>nitem, <span class="dt">nexaminee=</span>nexaminee, <span class="dt">seed=</span>seed[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb61-4" title="4"><span class="co"># Estimate item parameters</span></a>
<a class="sourceLine" id="cb61-5" title="5">step2 &lt;-<span class="st"> </span><span class="kw">estimate_par</span>(step1<span class="op">$</span>respdata, <span class="dt">guess =</span> guess)</a>
<a class="sourceLine" id="cb61-6" title="6"><span class="co"># Summarize results</span></a>
<a class="sourceLine" id="cb61-7" title="7">step3 &lt;-<span class="st"> </span><span class="kw">summarize</span>(step2, step1<span class="op">$</span>itempar)</a>
<a class="sourceLine" id="cb61-8" title="8"><span class="kw">summaryRprof</span>()<span class="op">$</span>by.self</a></code></pre></div>
<pre><code>                       self.time self.pct total.time total.pct
&quot;Estep.mirt&quot;                0.80    27.40       0.86     29.45
&quot;computeItemtrace&quot;          0.46    15.75       0.52     17.81
&quot;LogLikMstep&quot;               0.36    12.33       0.82     28.08
&quot;EM.group&quot;                  0.16     5.48       2.88     98.63
&quot;gr&quot;                        0.12     4.11       0.14      4.79
&quot;&lt;Anonymous&gt;&quot;               0.10     3.42       1.30     44.52
&quot;fn&quot;                        0.10     3.42       1.02     34.93
&quot;reloadPars&quot;                0.10     3.42       0.12      4.11
&quot;optim&quot;                     0.04     1.37       1.26     43.15
&quot;mahalanobis&quot;               0.04     1.37       0.12      4.11
&quot;.getClassesFromCache&quot;      0.04     1.37       0.04      1.37
&quot;@&lt;-&quot;                       0.04     1.37       0.04      1.37
&quot;as.matrix&quot;                 0.04     1.37       0.04      1.37
&quot;get0&quot;                      0.04     1.37       0.04      1.37
&quot;matrix&quot;                    0.04     1.37       0.04      1.37
&quot;doTryCatch&quot;                0.02     0.68       2.92    100.00
&quot;tryCatch&quot;                  0.02     0.68       2.92    100.00
&quot;FUN&quot;                       0.02     0.68       2.90     99.32
&quot;Mstep&quot;                     0.02     0.68       1.38     47.26
&quot;.External2&quot;                0.02     0.68       1.20     41.10
&quot;updatePrior&quot;               0.02     0.68       0.24      8.22
&quot;getCallingDLLe&quot;            0.02     0.68       0.06      2.05
&quot;is&quot;                        0.02     0.68       0.06      2.05
&quot;getClass&quot;                  0.02     0.68       0.04      1.37
&quot;solve.default&quot;             0.02     0.68       0.04      1.37
&quot;sys.function&quot;              0.02     0.68       0.04      1.37
&quot;[&quot;                         0.02     0.68       0.02      0.68
&quot;close.connection&quot;          0.02     0.68       0.02      0.68
&quot;grepl&quot;                     0.02     0.68       0.02      0.68
&quot;ifelse&quot;                    0.02     0.68       0.02      0.68
&quot;length&quot;                    0.02     0.68       0.02      0.68
&quot;longpars_constrain&quot;        0.02     0.68       0.02      0.68
&quot;nrow&quot;                      0.02     0.68       0.02      0.68
&quot;rev.default&quot;               0.02     0.68       0.02      0.68
&quot;rowSums&quot;                   0.02     0.68       0.02      0.68
&quot;setNames&quot;                  0.02     0.68       0.02      0.68
&quot;sys.parent&quot;                0.02     0.68       0.02      0.68</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" title="1"><span class="kw">Rprof</span>(<span class="ot">NULL</span>) <span class="co"># Turn off profiling</span></a></code></pre></div>
<p>In the output, “self.pct” is the most important column because it indicates the percentage of time that each of the listed tasks has taken in the estimation process.</p>
<p>Next, let’s see how the <code>tictoc</code> package works for finding running time of our code. Between each <code>tic()</code> and <code>toc()</code>, it saves the time spent. So, we place several <code>tic()</code> and <code>toc()</code> functions. The first one, <code>tic("Total simulation time:")</code> will be closed at the end so that we can see the total time spent on the simulation. The others in between will calculate the time for each step (i.e., step 1, step 2, and step 3).</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" title="1"><span class="kw">library</span>(<span class="st">&quot;tictoc&quot;</span>)</a>
<a class="sourceLine" id="cb64-2" title="2"><span class="kw">tic</span>(<span class="st">&quot;Total simulation time:&quot;</span>)</a>
<a class="sourceLine" id="cb64-3" title="3"><span class="kw">tic</span>(<span class="st">&quot;Generate item parameters and data&quot;</span>)</a>
<a class="sourceLine" id="cb64-4" title="4">step1 &lt;-<span class="st"> </span><span class="kw">generate_data</span>(<span class="dt">nitem=</span>nitem, <span class="dt">nexaminee=</span>nexaminee, <span class="dt">seed=</span>seed[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb64-5" title="5"><span class="kw">toc</span>()</a></code></pre></div>
<pre><code>Generate item parameters and data: 0.01 sec elapsed</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" title="1"><span class="kw">tic</span>(<span class="st">&quot;Estimate item parameters&quot;</span>)</a>
<a class="sourceLine" id="cb66-2" title="2">step2 &lt;-<span class="st"> </span><span class="kw">estimate_par</span>(step1<span class="op">$</span>respdata, <span class="dt">guess =</span> guess)</a>
<a class="sourceLine" id="cb66-3" title="3"><span class="kw">toc</span>()</a></code></pre></div>
<pre><code>Estimate item parameters: 2.97 sec elapsed</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" title="1"><span class="kw">tic</span>(<span class="st">&quot;Summarize results&quot;</span>)</a>
<a class="sourceLine" id="cb68-2" title="2">step3 &lt;-<span class="st"> </span><span class="kw">summarize</span>(step2, step1<span class="op">$</span>itempar)</a>
<a class="sourceLine" id="cb68-3" title="3"><span class="kw">toc</span>()</a></code></pre></div>
<pre><code>Summarize results: 0.02 sec elapsed</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" title="1"><span class="kw">toc</span>()</a></code></pre></div>
<pre><code>Total simulation time:: 3 sec elapsed</code></pre>
<p>Finally, let’s add a progress bar to our simulation study. We will use the <code>txtProgressBar</code> function from base R and the <code>doSNOW</code> package <span class="citation">(Corporation and Weston <a href="#ref-R-doSNOW" role="doc-biblioref">2019</a><a href="#ref-R-doSNOW" role="doc-biblioref">a</a>)</span> together. The <code>txtProgressBar</code> function is a standalone function and thus it does not require other packages to print a progress bar. However, in the following example, we will do parallel computing using the <code>doSNOW</code> package (it is very similar to <code>doParallel</code>) and add a progress bar into our simulation. This will require us to add <code>.options.snow</code> in the loop so that the progress bar works along with the simulation.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" title="1">iterations =<span class="st"> </span><span class="dv">10</span> <span class="co">#Eventually this will be 100</span></a>
<a class="sourceLine" id="cb72-2" title="2">seed =<span class="st"> </span><span class="kw">sample.int</span>(<span class="dv">10000</span>, <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb72-3" title="3">nitem =<span class="st"> </span><span class="dv">10</span> <span class="co">#10, 15, 20, or 25</span></a>
<a class="sourceLine" id="cb72-4" title="4">nexaminee =<span class="st"> </span><span class="dv">1000</span> <span class="co">#250, 500, 750, or 1000</span></a>
<a class="sourceLine" id="cb72-5" title="5">guess =<span class="st"> </span><span class="dv">-1</span> <span class="co">#A negative value or a value from 0 to 1</span></a>
<a class="sourceLine" id="cb72-6" title="6"></a>
<a class="sourceLine" id="cb72-7" title="7"><span class="kw">library</span>(<span class="st">&quot;doSNOW&quot;</span>)</a>
<a class="sourceLine" id="cb72-8" title="8">cl &lt;-<span class="st"> </span><span class="kw">makeCluster</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb72-9" title="9"><span class="kw">registerDoSNOW</span>(cl)</a>
<a class="sourceLine" id="cb72-10" title="10"></a>
<a class="sourceLine" id="cb72-11" title="11"><span class="co"># Set up the progress bar</span></a>
<a class="sourceLine" id="cb72-12" title="12">pb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(<span class="dt">max =</span> iterations, <span class="dt">style =</span> <span class="dv">3</span>) <span class="co"># Initiate progress bar</span></a>
<a class="sourceLine" id="cb72-13" title="13">progress &lt;-<span class="st"> </span><span class="cf">function</span>(n) {<span class="kw">setTxtProgressBar</span>(pb, n)}</a>
<a class="sourceLine" id="cb72-14" title="14">opts &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">progress =</span> progress)</a>
<a class="sourceLine" id="cb72-15" title="15"></a>
<a class="sourceLine" id="cb72-16" title="16"><span class="co"># Run the simulation</span></a>
<a class="sourceLine" id="cb72-17" title="17">simresults &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i=</span><span class="dv">1</span><span class="op">:</span>iterations, </a>
<a class="sourceLine" id="cb72-18" title="18">                      <span class="dt">.packages =</span> <span class="kw">c</span>(<span class="st">&quot;mirt&quot;</span>, <span class="st">&quot;doSNOW&quot;</span>),</a>
<a class="sourceLine" id="cb72-19" title="19">                      <span class="dt">.options.snow =</span> opts, <span class="co"># see the additional line for doSNOW</span></a>
<a class="sourceLine" id="cb72-20" title="20">                      <span class="dt">.combine =</span> rbind) <span class="op">%dopar%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb72-21" title="21">                        <span class="co"># Generate item parameters and data</span></a>
<a class="sourceLine" id="cb72-22" title="22">                        step1 &lt;-<span class="st"> </span><span class="kw">generate_data</span>(<span class="dt">nitem=</span>nitem, <span class="dt">nexaminee=</span>nexaminee, <span class="dt">seed=</span>seed[i])</a>
<a class="sourceLine" id="cb72-23" title="23">                        <span class="co"># Estimate item parameters</span></a>
<a class="sourceLine" id="cb72-24" title="24">                        step2 &lt;-<span class="st"> </span><span class="kw">estimate_par</span>(step1<span class="op">$</span>respdata, <span class="dt">guess =</span> guess)</a>
<a class="sourceLine" id="cb72-25" title="25">                        <span class="co"># Summarize results</span></a>
<a class="sourceLine" id="cb72-26" title="26">                        <span class="kw">summarize</span>(step2, step1<span class="op">$</span>itempar)</a>
<a class="sourceLine" id="cb72-27" title="27">                      }</a>
<a class="sourceLine" id="cb72-28" title="28"><span class="kw">close</span>(pb) <span class="co"># Close progress bar</span></a>
<a class="sourceLine" id="cb72-29" title="29"><span class="kw">stopCluster</span>(cl)</a></code></pre></div>
<p>As the simulation progresses, we should see a progress bar with a percent sign at the end, which is <code>style = 3</code> in the <code>txtProgressBar</code> function<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>. Once the simulation is complete, we should see the following screen in the console:</p>
<div class="figure">
<img src="figure/bench1.PNG" alt="Status of progress bar once the simulation is complete" />
<p class="caption">Status of progress bar once the simulation is complete</p>
</div>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-mirt">
<p>Chalmers, Phil. 2019. <em>Mirt: Multidimensional Item Response Theory</em>. <a href="https://CRAN.R-project.org/package=mirt">https://CRAN.R-project.org/package=mirt</a>.</p>
</div>
<div id="ref-R-doSNOW">
<p>Corporation, Microsoft, and Stephen Weston. 2019a. <em>DoSNOW: Foreach Parallel Adaptor for the ’Snow’ Package</em>. <a href="https://CRAN.R-project.org/package=doSNOW">https://CRAN.R-project.org/package=doSNOW</a>.</p>
</div>
<div id="ref-R-doParallel">
<p>Corporation, Microsoft, and Steve Weston. 2019b. <em>DoParallel: Foreach Parallel Adaptor for the ’Parallel’ Package</em>. <a href="https://CRAN.R-project.org/package=doParallel">https://CRAN.R-project.org/package=doParallel</a>.</p>
</div>
<div id="ref-R-bench">
<p>Hester, Jim. 2020. <em>Bench: High Precision Timing of R Expressions</em>. <a href="https://CRAN.R-project.org/package=bench">https://CRAN.R-project.org/package=bench</a>.</p>
</div>
<div id="ref-R-tictoc">
<p>Izrailev, Sergei. 2020. <em>Tictoc: Functions for Timing R Scripts, as Well as Implementations of Stack and List Structures</em>. <a href="http://github.com/jabiru/tictoc">http://github.com/jabiru/tictoc</a>.</p>
</div>
<div id="ref-R-rbenchmark">
<p>Kusnierczyk, Wacek. 2012. <em>Rbenchmark: Benchmarking Routine for R</em>. <a href="https://CRAN.R-project.org/package=rbenchmark">https://CRAN.R-project.org/package=rbenchmark</a>.</p>
</div>
<div id="ref-R-microbenchmark">
<p>Mersmann, Olaf. 2019. <em>Microbenchmark: Accurate Timing Functions</em>. <a href="https://CRAN.R-project.org/package=microbenchmark">https://CRAN.R-project.org/package=microbenchmark</a>.</p>
</div>
<div id="ref-R-foreach">
<p>Microsoft, and Steve Weston. 2020. <em>Foreach: Provides Foreach Looping Construct</em>. <a href="https://CRAN.R-project.org/package=foreach">https://CRAN.R-project.org/package=foreach</a>.</p>
</div>
<div id="ref-R-irtoys">
<p>Partchev, Ivailo, and Gunter Maris. 2017. <em>Irtoys: A Collection of Functions Related to Item Response Theory (Irt)</em>. <a href="https://CRAN.R-project.org/package=irtoys">https://CRAN.R-project.org/package=irtoys</a>.</p>
</div>
<div id="ref-R-dplyr">
<p>Wickham, Hadley, Romain François, Lionel Henry, and Kirill Müller. 2020. <em>Dplyr: A Grammar of Data Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr">https://CRAN.R-project.org/package=dplyr</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>See <a href="https://www.guru99.com/r-apply-sapply-tapply.html">the Guru99 website</a> for more information on these functions.<a href="run.html#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>For a quick introduction to parallel computing in <code>R</code>, you can check out <a href="https://nceas.github.io/oss-lessons/parallel-computing-in-r/parallel-computing-in-r.html">this website</a>.<a href="run.html#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p>If the computer has a Mac operating system, then <code>cl &lt;- makeCluster(4, outfile="")</code> should be used.<a href="run.html#fnref4" class="footnote-back">↩</a></p></li>
<li id="fn5"><p>The results would be very similar across all iterations using the same conditions.<a href="run.html#fnref5" class="footnote-back">↩</a></p></li>
<li id="fn6"><p>There are also styles 1 and 2. Check out <code>?txtProgressBar</code> for examples.<a href="run.html#fnref6" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="design.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="summarise.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/okanbulut/simulations_in_r/tree/master/02-run.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["simulations_in_r.pdf", "simulations_in_r.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
